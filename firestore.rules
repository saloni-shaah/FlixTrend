rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // A user's role is stored in their auth token as a custom claim.
    // This function checks if the user has the 'admin' claim set to true.
    function isAdmin() {
      return request.auth.token.admin == true;
    }

    match /users/{userId} {
      // Anyone can read public user profiles.
      allow read: if true;

      // Users can only create or update their own profile.
      // They cannot grant themselves a role.
      allow create, update: if request.auth.uid == userId && !('role' in request.resource.data);

      // An admin can update the 'role' field of any user.
      // This is the rule that will allow your admin page to function.
      allow update (role): if isAdmin();
    }
    
    match /{document=**} {
        allow read, write: if false;
    }
  }
}
