{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/NotificationPanel.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { useState, useEffect } from 'react';\nimport { getFirestore, collection, query, orderBy, onSnapshot, doc, getDoc } from 'firebase/firestore';\nimport { auth, app } from '@/utils/firebaseClient';\nimport Link from 'next/link';\n\nconst db = getFirestore(app);\n\n// This new sub-component handles fetching and rendering for each notification\nfunction NotificationItem({ notification }: { notification: any }) {\n  const [fromUser, setFromUser] = useState<any>(null);\n\n  useEffect(() => {\n    // Fetch the user data for the user who triggered the notification\n    const fetchUserData = async () => {\n      if (notification.fromUserId) {\n        const userRef = doc(db, \"users\", notification.fromUserId);\n        const userSnap = await getDoc(userRef);\n        if (userSnap.exists()) {\n          setFromUser(userSnap.data());\n        }\n      }\n    };\n\n    fetchUserData();\n  }, [notification.fromUserId]);\n\n  const getNotificationDetails = (notif: any) => {\n    // Use the fresh username, fall back to the one stored in the notification\n    const username = fromUser?.username || notif.fromUsername;\n    let message: React.ReactNode;\n    let linkPath = '/'; // Default link\n\n    switch (notif.type) {\n      case 'like':\n        message = <><span className=\"font-bold\">{username}</span> liked your post.</>;\n        if(notif.postId) linkPath = `/post/${notif.postId}`;\n        break;\n      case 'comment':\n        message = <><span className=\"font-bold\">{username}</span> commented: \"{notif.postContent}\"</>;\n        if(notif.postId) linkPath = `/post/${notif.postId}`;\n        break;\n      case 'follow':\n        message = <><span className=\"font-bold\">{username}</span> started following you.</>;\n        if(notif.fromUserId) linkPath = `/squad/${notif.fromUserId}`;\n        break;\n      case 'missed_call':\n        message = <><span className=\"font-bold\">{username}</span> tried to call you.</>;\n        if(notif.fromUserId) linkPath = `/squad/${notif.fromUserId}`;\n        break;\n      default:\n        message = 'New notification';\n        break;\n    }\n    return { message, linkPath };\n  };\n\n  const { message, linkPath } = getNotificationDetails(notification);\n  // Always use the fresh avatar URL from the fetched user profile\n  const avatarUrl = fromUser?.avatar_url;\n  const initials = fromUser?.name?.charAt(0) || fromUser?.username?.charAt(0) || '?';\n\n  return (\n    <Link href={linkPath} className=\"flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-all cursor-pointer\">\n        <div className=\"w-10 h-10 rounded-full bg-gradient-to-tr from-accent-pink to-accent-green overflow-hidden flex-shrink-0 flex items-center justify-center\">\n        {avatarUrl ? (\n            <img src={avatarUrl} alt=\"avatar\" className=\"w-full h-full object-cover\" />\n        ) : (\n            <span className=\"font-bold text-white\">{initials.toUpperCase()}</span>\n        )}\n        </div>\n        <div className=\"flex-1 text-sm\">\n        {message}\n        <div className=\"text-xs text-muted-foreground mt-1\">{notification.createdAt?.toDate().toLocaleString()}</div>\n        </div>\n    </Link>\n  );\n}\n\nexport default function NotificationPanel({ onClose }: { onClose: () => void }) {\n  const [notifications, setNotifications] = useState<any[]>([]);\n  const currentUser = auth.currentUser;\n\n  useEffect(() => {\n    if (!currentUser) return;\n    const q = query(\n      collection(db, \"users\", currentUser.uid, \"notifications\"),\n      orderBy(\"createdAt\", \"desc\")\n    );\n    const unsub = onSnapshot(q, (snapshot) => {\n      setNotifications(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\n    });\n    return () => unsub();\n  }, [currentUser]);\n\n  return (\n    <div className=\"fixed inset-y-0 right-0 z-50 w-full max-w-sm glass-card animate-slide-in-right\">\n      <div className=\"flex items-center justify-between p-4 border-b border-glass-border\">\n        <h3 className=\"text-xl font-headline font-bold text-brand-gold\">Notifications</h3>\n        <button onClick={onClose} className=\"text-accent-pink text-2xl\">&times;</button>\n      </div>\n      <div className=\"flex flex-col gap-2 p-4 overflow-y-auto h-full pb-20\">\n        {notifications.length === 0 ? (\n          <div className=\"text-muted-foreground text-center mt-16\">No new notifications.</div>\n        ) : (\n          notifications.map(notif => (\n            <NotificationItem key={notif.id} notification={notif} />\n          ))\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}