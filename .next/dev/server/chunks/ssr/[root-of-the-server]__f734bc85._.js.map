{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { v2 as cloudinary } from 'cloudinary';\nimport { revalidatePath } from 'next/cache';\nimport { initializeApp, getApps, cert } from 'firebase-admin/app';\nimport { getStorage } from 'firebase-admin/storage';\nimport { v4 as uuidv4 } from 'uuid';\n\n// --- Cloudinary Configuration & Upload ---\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nexport async function uploadToCloudinary(formData: FormData) {\n  const file = formData.get('file') as File;\n  const arrayBuffer = await file.arrayBuffer();\n  const buffer = new Uint8Array(arrayBuffer);\n\n  try {\n    const results: any = await new Promise((resolve, reject) => {\n      cloudinary.uploader.upload_stream({ resource_type: 'auto' }, (error, result) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve(result);\n        }\n      }).end(buffer);\n    });\n    return { success: true, url: results.secure_url };\n  } catch (error) {\n    console.error('Cloudinary upload failed:', error);\n    return { success: false, error: 'Upload failed' };\n  }\n}\n\n// --- Firebase Admin Configuration & Upload ---\nconst serviceAccount = JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT_KEY as string);\n\nif (!getApps().length) {\n  initializeApp({\n    credential: cert(serviceAccount),\n    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET\n  });\n}\n\nexport async function uploadFileToFirebaseStorage(formData: FormData) {\n  const file = formData.get('file') as File;\n  const userId = formData.get('userId') as string;\n\n  if (!file || !userId) {\n    return { failure: 'File or user ID is missing.' };\n  }\n  \n  const bucket = getStorage().bucket();\n  const fileExtension = file.name.split('.').pop();\n  const fileName = `${userId}/${uuidv4()}.${fileExtension}`;\n  const blob = bucket.file(fileName);\n  \n  const arrayBuffer = await file.arrayBuffer();\n  const buffer = Buffer.from(arrayBuffer);\n\n  try {\n    await new Promise((resolve, reject) => {\n      const blobStream = blob.createWriteStream({\n        metadata: {\n          contentType: file.type,\n        },\n      });\n\n      blobStream.on('error', (err) => {\n        console.error('Firebase upload stream error:', err);\n        reject(err);\n      });\n\n      blobStream.on('finish', () => {\n        // The public URL can be constructed like this.\n        // You might want to make it a signed URL for private files.\n        const publicUrl = `https://firebasestorage.googleapis.com/v0/b/${bucket.name}/o/${encodeURIComponent(fileName)}?alt=media`;\n        resolve(publicUrl);\n      });\n\n      blobStream.end(buffer);\n    });\n\n    const publicUrl = `https://firebasestorage.googleapis.com/v0/b/${bucket.name}/o/${encodeURIComponent(fileName)}?alt=media`;\n    return { success: { url: publicUrl } };\n\n  } catch (error) {\n    console.error('Firebase upload failed:', error);\n    return { failure: 'Firebase upload process failed.' };\n  }\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;AAEA,4CAA4C;AAC5C,8IAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;AAEO,eAAe,mBAAmB,QAAkB;IACzD,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,SAAS,IAAI,WAAW;IAE9B,IAAI;QACF,MAAM,UAAe,MAAM,IAAI,QAAQ,CAAC,SAAS;YAC/C,8IAAU,CAAC,QAAQ,CAAC,aAAa,CAAC;gBAAE,eAAe;YAAO,GAAG,CAAC,OAAO;gBACnE,IAAI,OAAO;oBACT,OAAO;gBACT,OAAO;oBACL,QAAQ;gBACV;YACF,GAAG,GAAG,CAAC;QACT;QACA,OAAO;YAAE,SAAS;YAAM,KAAK,QAAQ,UAAU;QAAC;IAClD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;YAAE,SAAS;YAAO,OAAO;QAAgB;IAClD;AACF;AAEA,gDAAgD;AAChD,MAAM,iBAAiB,KAAK,KAAK,CAAC,QAAQ,GAAG,CAAC,4BAA4B;AAE1E,IAAI,CAAC,IAAA,2JAAO,IAAG,MAAM,EAAE;IACrB,IAAA,iKAAa,EAAC;QACZ,YAAY,IAAA,wJAAI,EAAC;QACjB,aAAa;IACf;AACF;AAEO,eAAe,4BAA4B,QAAkB;IAClE,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,MAAM,SAAS,SAAS,GAAG,CAAC;IAE5B,IAAI,CAAC,QAAQ,CAAC,QAAQ;QACpB,OAAO;YAAE,SAAS;QAA8B;IAClD;IAEA,MAAM,SAAS,IAAA,sKAAU,IAAG,MAAM;IAClC,MAAM,gBAAgB,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;IAC9C,MAAM,WAAW,GAAG,OAAO,CAAC,EAAE,IAAA,gLAAM,IAAG,CAAC,EAAE,eAAe;IACzD,MAAM,OAAO,OAAO,IAAI,CAAC;IAEzB,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,SAAS,OAAO,IAAI,CAAC;IAE3B,IAAI;QACF,MAAM,IAAI,QAAQ,CAAC,SAAS;YAC1B,MAAM,aAAa,KAAK,iBAAiB,CAAC;gBACxC,UAAU;oBACR,aAAa,KAAK,IAAI;gBACxB;YACF;YAEA,WAAW,EAAE,CAAC,SAAS,CAAC;gBACtB,QAAQ,KAAK,CAAC,iCAAiC;gBAC/C,OAAO;YACT;YAEA,WAAW,EAAE,CAAC,UAAU;gBACtB,+CAA+C;gBAC/C,4DAA4D;gBAC5D,MAAM,YAAY,CAAC,4CAA4C,EAAE,OAAO,IAAI,CAAC,GAAG,EAAE,mBAAmB,UAAU,UAAU,CAAC;gBAC1H,QAAQ;YACV;YAEA,WAAW,GAAG,CAAC;QACjB;QAEA,MAAM,YAAY,CAAC,4CAA4C,EAAE,OAAO,IAAI,CAAC,GAAG,EAAE,mBAAmB,UAAU,UAAU,CAAC;QAC1H,OAAO;YAAE,SAAS;gBAAE,KAAK;YAAU;QAAE;IAEvC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO;YAAE,SAAS;QAAkC;IACtD;AACF;;;IA9EsB;IAgCA;;AAhCA,+OAAA;AAgCA,+OAAA"}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/home/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {uploadToCloudinary as '407b2f8a817403eab92b38dde1450c73bc1cd0cba6'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}