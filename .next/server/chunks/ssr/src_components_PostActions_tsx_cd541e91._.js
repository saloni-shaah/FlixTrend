module.exports=[87156,84505,33882,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(69387);var d=a.i(60574),e=a.i(2768),f=a.i(21374),g=a.i(40541),h=a.i(45222),i=a.i(38617);let j=(0,a.i(70106).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);a.s(["Download",()=>j],84505);var k=a.i(25408),l=a.i(96428),m=a.i(46271),n=a.i(92759),o=a.i(87532),p=a.i(60246),q=a.i(82434);let r=(0,d.getFirestore)(k.app);function s({post:a,onClose:e}){let[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!0),[j,l]=(0,c.useState)(""),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!1),w=k.auth.currentUser;(0,c.useEffect)(()=>{w&&(async()=>{let a=(0,d.query)((0,d.collection)(r,"groups"),(0,d.where)("members","array-contains",w.uid)),b=(await (0,d.getDocs)(a)).docs.map(a=>({...a.data(),id:a.id,isGroup:!0})),c=(0,d.collection)(r,"users",w.uid,"following"),e=(0,d.collection)(r,"users",w.uid,"followers"),[f,h]=await Promise.all([(0,d.getDocs)(c),(0,d.getDocs)(e)]),j=[...new Set([...f.docs.map(a=>a.id),...h.docs.map(a=>a.id)])].map(a=>(0,d.getDocs)((0,d.query)((0,d.collection)(r,"users"),(0,d.where)("uid","==",a)))),k=(await Promise.all(j)).flatMap(a=>a.docs.map(a=>({...a.data(),id:a.id,isGroup:!1})));g([{id:`almighty-chat_${w.uid}`,name:"Almighty",isAlmighty:!0},...b,...k]),i(!1)})()},[w]);let x=async()=>{if(0===s.length||!w)return;v(!0);let b=`Check out this vibe! ${window.location.origin}/post/${a.id}`,c=s.map(c=>{let e=c,g=f.find(a=>a.id===c);return!g||g.isGroup||g.isAlmighty||(e=[w.uid,g.id].sort().join("_")),(0,d.addDoc)((0,d.collection)(r,"chats",e,"messages"),{text:b,sender:w.uid,createdAt:(0,d.serverTimestamp)(),type:"share",sharedPost:a})});await Promise.all(c),v(!1),e()},y=j?f.filter(a=>a.name?.toLowerCase().includes(j.toLowerCase())||a.username?.toLowerCase().includes(j.toLowerCase())):f;return(0,b.jsx)("div",{className:"fixed inset-0 z-[102] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:e,children:(0,b.jsxs)(m.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"glass-card p-4 w-full max-w-md relative flex flex-col max-h-[80vh]",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("h2",{className:"text-xl font-headline font-bold mb-4 text-accent-cyan text-center",children:"Share to Signal"}),(0,b.jsxs)("div",{className:"relative mb-4",children:[(0,b.jsx)("input",{type:"text",placeholder:"Search chats...",className:"input-glass w-full pl-10",value:j,onChange:a=>l(a.target.value)}),(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto mb-4 border-y border-accent-cyan/10 py-2",children:h?(0,b.jsx)("p",{className:"text-center text-gray-400",children:"Loading chats..."}):(0,b.jsx)("div",{className:"flex flex-col gap-1",children:y.map(a=>(0,b.jsxs)("div",{className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors ${s.includes(a.id)?"bg-accent-cyan/20":"hover:bg-accent-cyan/10"}`,onClick:()=>{var b;return b=a.id,void t(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-tr from-accent-pink to-accent-cyan flex items-center justify-center text-white font-bold text-lg overflow-hidden shrink-0",children:a.isAlmighty?(0,b.jsx)(q.Bot,{}):a.isGroup?a.avatar_url?(0,b.jsx)("img",{src:a.avatar_url,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)(p.Users,{}):a.avatar_url?(0,b.jsx)("img",{src:a.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):a?.name?.[0]||a?.username?.[0]||"U"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-bold text-sm truncate",children:a.name||a.username}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:a.isGroup?`${a.members?.length} members`:a.isAlmighty?"AI Assistant":`@${a.username}`})]})]},a.id))})}),(0,b.jsxs)("div",{className:"flex gap-2 mt-auto",children:[(0,b.jsx)("button",{className:"btn-glass flex-1",onClick:e,children:"Cancel"}),(0,b.jsxs)("button",{className:"btn-glass bg-accent-cyan text-black flex-1 flex items-center justify-center gap-2",onClick:x,disabled:u||0===s.length,children:[u?"Sending...":`Send to ${s.length} chat(s)`," ",(0,b.jsx)(n.Send,{size:16})]})]})]})})}let t=(0,d.getFirestore)(k.app);function u({post:a,onClose:e}){let[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!0),[j,l]=(0,c.useState)(!1),[n,o]=(0,c.useState)(""),p=k.auth.currentUser;(0,c.useEffect)(()=>{if(!p)return;let a=(0,d.query)((0,d.collection)(t,"collections"),(0,d.where)("ownerId","==",p.uid)),b=(0,d.onSnapshot)(a,a=>{g(a.docs.map(a=>({id:a.id,...a.data()}))),i(!1)});return()=>b()},[p]);let q=async()=>{n.trim()&&p&&(await (0,d.addDoc)((0,d.collection)(t,"collections"),{name:n,ownerId:p.uid,createdAt:(0,d.serverTimestamp)(),postIds:[a.id]}),o(""),l(!1),e())},r=async b=>{let c=(0,d.doc)(t,"collections",b);await (0,d.updateDoc)(c,{postIds:(0,d.arrayUnion)(a.id)}),e()};return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:(0,b.jsxs)(m.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"glass-card p-6 w-full max-w-md relative flex flex-col max-h-[80vh]",children:[(0,b.jsx)("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white",children:"Ã—"}),(0,b.jsx)("h2",{className:"text-xl font-headline font-bold mb-4 text-accent-cyan",children:"Save to Collection"}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto mb-4 border-y border-accent-cyan/10 py-2",children:h?(0,b.jsx)("p",{className:"text-center text-gray-400",children:"Loading collections..."}):(0,b.jsx)("div",{className:"flex flex-col gap-2",children:f.map(a=>(0,b.jsx)("button",{onClick:()=>r(a.id),className:"text-left p-3 rounded-lg hover:bg-accent-cyan/10 w-full",children:a.name},a.id))})}),j?(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",placeholder:"New collection name...",value:n,onChange:a=>o(a.target.value),className:"input-glass flex-1"}),(0,b.jsx)("button",{onClick:q,className:"btn-glass bg-accent-pink",children:"Create"})]}):(0,b.jsx)("button",{className:"btn-glass bg-accent-cyan/50 text-white",onClick:()=>l(!0),children:"Create New Collection"})]})})}let v="downloadedPosts",w=null;function x(){return new Promise((a,b)=>{if(w)return a(w);let c=indexedDB.open("FlixTrendDB",1);c.onerror=a=>{console.error("IndexedDB error:",c.error),b("IndexedDB error")},c.onsuccess=b=>{a(w=c.result)},c.onupgradeneeded=a=>{let b=c.result;b.objectStoreNames.contains(v)||b.createObjectStore(v,{keyPath:"id"})}})}async function y(a){let b=await x();return new Promise((c,d)=>{let e=b.transaction(v,"readwrite").objectStore(v).put({...a,downloadedAt:new Date});e.onsuccess=()=>c(),e.onerror=()=>d(e.error)})}async function z(){let a=await x();return new Promise((b,c)=>{let d=a.transaction(v,"readonly").objectStore(v).getAll();d.onsuccess=()=>{b(d.result.sort((a,b)=>b.downloadedAt-a.downloadedAt))},d.onerror=()=>c(d.error)})}async function A(a){let b=await x();return new Promise((c,d)=>{let e=b.transaction(v,"readwrite").objectStore(v).delete(a);e.onsuccess=()=>c(),e.onerror=()=>d(e.error)})}async function B(a){let b=await x();return new Promise((c,d)=>{let e=b.transaction(v,"readonly").objectStore(v).get(a);e.onsuccess=()=>{c(!!e.result)},e.onerror=()=>d(e.error)})}a.s(["getDownloadedPosts",()=>z,"isPostDownloaded",()=>B,"removeDownloadedPost",()=>A,"savePostForOffline",()=>y],33882);var C=a.i(68114);class D extends Error{context;constructor(a){super(`FirestoreError: Missing or insufficient permissions: The following request was denied by Firestore Security Rules:
{
  "operation": "${a.operation}",
  "path": "${a.path}"
  ${a.requestResourceData?`,"requestData": ${JSON.stringify(a.requestResourceData,null,2)}`:""}
}`),this.name="FirestorePermissionError",this.context=a}}var E=a.i(81056);let F=(0,d.getFirestore)(k.app);function G({post:a,onCommentClick:m,isShortVibe:n=!1}){let[o,p]=c.default.useState(0),[q,r]=c.default.useState(!1),[t,v]=c.default.useState(0),[w,x]=c.default.useState(!1),[z,G]=c.default.useState(0),[H,I]=c.default.useState(!1),[J,K]=c.default.useState(!1),[L,M]=c.default.useState(!1),[N,O]=c.default.useState(!1),P=k.auth.currentUser;c.default.useEffect(()=>{if(!a.id)return;let b=(0,d.doc)(F,"posts",a.id),c=(0,d.onSnapshot)(b,a=>{let b=a.data();if(b&&b.likes){let a=b.likes;p(Object.values(a).filter(a=>!0===a).length),P&&r(!!a[P.uid])}else p(0),r(!1)}),e=(0,d.onSnapshot)((0,d.collection)(F,"posts",a.id,"relays"),a=>v(a.size)),f=(0,d.onSnapshot)((0,d.collection)(F,"posts",a.id,"comments"),a=>G(a.size));return B(a.id).then(O),()=>{c(),e(),f()}},[a.id,P]);let Q=async b=>{if(b.stopPropagation(),!P)return;let c=(0,d.doc)(F,"posts",a.id),e=P.uid,f={[`likes.${e}`]:!q};if(r(!q),p(a=>q?a-1:a+1),(0,d.updateDoc)(c,f).catch(async a=>{r(q),p(a=>q?a+1:a-1);let b=new D({path:c.path,operation:"update",requestResourceData:f});E.errorEmitter.emit("permission-error",b)}),!q&&a.userId!==P.uid){let b=(0,d.collection)(F,"users",a.userId,"notifications"),c={type:"like",fromUserId:P.uid,fromUsername:P.displayName,fromAvatarUrl:P.photoURL,postId:a.id,postContent:a.content?.substring(0,50)||"your post",createdAt:(0,d.serverTimestamp)(),read:!1};(0,d.addDoc)(b,c).catch(a=>{console.error("Error sending notification:",a);let d=new D({path:b.path,operation:"create",requestResourceData:c});E.errorEmitter.emit("permission-error",d)})}},R=async b=>{b.stopPropagation(),P&&(0,d.runTransaction)(F,async b=>{let c=(0,d.doc)(F,"users",P.uid,"relayedPosts",a.id),e=(0,d.doc)(F,"posts",a.id,"relays",P.uid);if((await b.get(c)).exists())return;let f={type:"relay",originalPostId:a.id,originalPost:a,userId:P.uid,username:P.displayName,avatar_url:P.photoURL,createdAt:(0,d.serverTimestamp)(),publishAt:(0,d.serverTimestamp)()};b.set((0,d.doc)((0,d.collection)(F,"posts")),f),b.set(c,{relayedAt:(0,d.serverTimestamp)()}),b.set(e,{userId:P.uid,username:P.displayName,createdAt:(0,d.serverTimestamp)()})}).catch(async b=>{let c=new D({path:a.id,operation:"write",requestResourceData:{relay:!0}});E.errorEmitter.emit("permission-error",c)})},S=async b=>{b.stopPropagation();try{N?(await A(a.id),O(!1)):(await y(a),O(!0))}catch(a){console.error("Offline action failed:",a)}},T=n?"text-white":"text-muted-foreground";return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:(0,C.cn)("flex items-center",n?"flex-col gap-4":"justify-between mt-2 pt-2 border-t border-glass-border"),children:[(0,b.jsxs)("div",{className:(0,C.cn)("flex items-center justify-start",n?"flex-col gap-4":"gap-6"),children:[(0,b.jsxs)("button",{className:(0,C.cn)("flex items-center gap-1.5 font-bold transition-all text-lg",T,"hover:text-brand-gold"),onClick:a=>{a.stopPropagation(),m()},children:[(0,b.jsx)(h.MessageCircle,{size:20}),!n&&(0,b.jsx)("span",{children:z})]}),(0,b.jsxs)("button",{className:(0,C.cn)("flex items-center gap-1.5 font-bold transition-all text-lg",w?"text-green-400":T,"hover:text-green-400"),onClick:R,children:[(0,b.jsx)(e.Repeat2,{size:20}),!n&&(0,b.jsx)("span",{children:t})]}),(0,b.jsxs)("button",{"data-like-button":"true",className:(0,C.cn)("flex items-center gap-1.5 font-bold transition-all text-lg",q?"text-yellow-400":T,"hover:text-yellow-400"),onClick:Q,children:[(0,b.jsx)(f.Star,{size:20,fill:q?"currentColor":"none"}),!n&&(0,b.jsx)("span",{children:o})]}),(0,b.jsx)("button",{className:(0,C.cn)("flex items-center gap-1.5 font-bold transition-all text-lg",T,"hover:text-accent-cyan"),onClick:a=>{a.stopPropagation(),I(!0)},children:(0,b.jsx)(g.Share,{size:20})})]}),!n&&(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("button",{className:(0,C.cn)("flex items-center gap-1.5 font-bold transition-all text-lg",T,N?"text-blue-400":"hover:text-blue-400"),onClick:S,title:"Save for Offline",children:(0,b.jsx)(j,{size:20})}),(0,b.jsx)("button",{className:(0,C.cn)("flex items-center gap-1.5 font-bold transition-all text-lg",T,"hover:text-accent-purple"),onClick:a=>{a.stopPropagation(),M(!0)},children:(0,b.jsx)(i.Bookmark,{size:20})})]})]}),H&&(0,b.jsx)(l.ShareModal,{url:`${window.location.origin}/post/${a.id}`,title:a.content,isVideo:"media"===a.type&&a.mediaUrl&&(Array.isArray(a.mediaUrl)?a.mediaUrl.some(a=>a.includes(".mp4")):a.mediaUrl.includes(".mp4")),onSignalShare:()=>{I(!1),K(!0)},onClose:()=>I(!1)}),J&&(0,b.jsx)(s,{post:a,onClose:()=>K(!1)}),L&&(0,b.jsx)(u,{post:a,onClose:()=>M(!1)})]})}a.s(["PostActions",()=>G],87156)}];

//# sourceMappingURL=src_components_PostActions_tsx_cd541e91._.js.map