module.exports=[38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},88347,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e={ACTION_HMR_REFRESH:function(){return k},ACTION_NAVIGATE:function(){return h},ACTION_REFRESH:function(){return g},ACTION_RESTORE:function(){return i},ACTION_SERVER_ACTION:function(){return l},ACTION_SERVER_PATCH:function(){return j},PrefetchKind:function(){return m}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g="refresh",h="navigate",i="restore",j="server-patch",k="hmr-refresh",l="server-action";var m=((d={}).AUTO="auto",d.FULL="full",d.TEMPORARY="temporary",d);("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},67009,(a,b,c)=>{"use strict";function d(a){return null!==a&&"object"==typeof a&&"then"in a&&"function"==typeof a.then}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isThenable",{enumerable:!0,get:function(){return d}})},90841,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={dispatchAppRouterAction:function(){return i},useActionQueue:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(46058)._(a.r(72131)),g=a.r(67009),h=null;function i(a){if(null===h)throw Object.defineProperty(Error("Internal Next.js error: Router action dispatched before initialization."),"__NEXT_ERROR_CODE",{value:"E668",enumerable:!1,configurable:!0});h(a)}function j(a){let[b,c]=f.default.useState(a.state);h=b=>a.dispatch(b,c);let d=(0,f.useMemo)(()=>b,[b]);return(0,g.isThenable)(d)?(0,f.use)(d):d}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},20611,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"callServer",{enumerable:!0,get:function(){return g}});let d=a.r(72131),e=a.r(88347),f=a.r(90841);async function g(a,b){return new Promise((c,g)=>{(0,d.startTransition)(()=>{(0,f.dispatchAppRouterAction)({type:e.ACTION_SERVER_ACTION,actionId:a,actionArgs:b,resolve:c,reject:g})})})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},1722,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"findSourceMapURL",{enumerable:!0,get:function(){return d}});("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},87532,a=>{"use strict";let b=(0,a.i(70106).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);a.s(["Search",()=>b],87532)},60246,a=>{"use strict";let b=(0,a.i(70106).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);a.s(["Users",()=>b],60246)},81560,a=>{"use strict";let b=(0,a.i(70106).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);a.s(["Trash2",()=>b],81560)},75596,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246);a.i(69387);var f=a.i(60574),g=a.i(25408),h=a.i(60246),i=a.i(87532),j=a.i(70106);let k=(0,j.default)("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),l=(0,j.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var m=a.i(81560),n=a.i(33508),o=a.i(49094),p=a.i(46271),q=a.i(62036),r=a.i(68114),s=a.i(63588);function t(){return(0,b.jsxs)(p.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},className:"text-center text-gray-500",children:[(0,b.jsx)(s.MessageSquare,{className:"mx-auto mb-4 text-gray-600",size:64,strokeWidth:1}),(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-300",children:"Welcome to Signal"}),(0,b.jsx)("p",{children:"Select a chat from the left to start a conversation."})]})}let u=(0,f.getFirestore)(g.app),v=c.default.memo(({chat:a,selectionMode:d,isSelected:e,onLongPress:f,onClick:g,drafts:i})=>{let j=((a=()=>{},b=300)=>{let d=(0,c.useRef)(),e=()=>{d.current=setTimeout(a,b)},f=()=>{d.current&&clearTimeout(d.current)};return{onTouchStart:e,onTouchEnd:f,onMouseDown:e,onMouseUp:f,onMouseLeave:f}})(f);return(0,b.jsxs)("div",{...j,className:(0,r.cn)("w-full flex items-center gap-4 px-4 py-3 text-left transition-colors duration-200 group relative",e?"bg-accent-cyan/30":"hover:bg-accent-cyan/10","cursor-pointer"),onClick:g,children:["chats"===d&&(0,b.jsx)("div",{className:"absolute left-2 top-1/2 -translate-y-1/2",children:e?(0,b.jsx)(k,{className:"text-accent-cyan"}):(0,b.jsx)(l,{className:"text-gray-500"})}),(0,b.jsxs)("div",{className:(0,r.cn)("relative w-12 h-12 rounded-full bg-gradient-to-tr from-accent-pink to-accent-cyan flex items-center justify-center text-white font-bold text-xl overflow-hidden shrink-0","chats"===d&&"ml-8"),children:[a.isGroup?a.avatar_url?(0,b.jsx)("img",{src:a.avatar_url,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)(h.Users,{}):a.avatar_url?(0,b.jsx)("img",{src:a.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):a?.name?.[0]||a?.username?.[0]||"U",a.unreadCount>0&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-accent-pink rounded-full flex items-center justify-center text-white text-[10px] font-bold border-2 border-background",children:a.unreadCount>9?"9+":a.unreadCount})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,b.jsx)("span",{className:"font-bold text-white block truncate",children:a.name||a.username}),(0,b.jsx)("span",{className:"text-xs text-gray-400 block truncate italic",children:i[a.id]?(0,b.jsxs)("span",{className:"text-red-400",children:["[Draft] ",i[a.id]]}):a.lastMessage?.text||"No messages yet"})]})]})});function w({firebaseUser:a,userProfile:g}){let[h,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(""),[r,s]=(0,c.useState)(null),[w,x]=(0,c.useState)(new Set),y=(0,d.useRouter)(),{drafts:z}=(0,o.useAppState)();(0,c.useEffect)(()=>{if(!a)return;let b=(0,f.query)((0,f.collection)(u,"groups"),(0,f.where)("members","array-contains",a.uid)),c=(0,f.onSnapshot)(b,async a=>{Promise.all(a.docs.map(a=>d(a,!0))).then(a=>{j(b=>{let c=new Set(b.filter(a=>!a.isGroup).map(a=>a.id)),d=a.filter(a=>!c.has(a.id));return[...b.filter(a=>!a.isGroup),...d].sort((a,b)=>(b.lastMessage?.createdAt?.toDate()||0)-(a.lastMessage?.createdAt?.toDate()||0))})})}),d=async(b,c)=>{let d={id:b.id,...b.data(),isGroup:c},e=c?b.id:[a.uid,b.id].sort().join("_"),g=(0,f.query)((0,f.collection)(u,"chats",e,"messages"),(0,f.orderBy)("createdAt","desc"),(0,f.limit)(1)),h=await (0,f.getDocs)(g),i=h.empty?null:h.docs[0].data(),j=(0,f.query)((0,f.collection)(u,"chats",e,"messages"),(0,f.where)("sender","!=",a.uid)),k=(await (0,f.getDocs)(j)).docs.filter(b=>!(b.data().readBy||[]).includes(a.uid)).length;return{...d,lastMessage:i,unreadCount:k}};return(async()=>{let b=(0,f.collection)(u,"users",a.uid,"following"),c=(0,f.collection)(u,"users",a.uid,"followers"),[e,g]=await Promise.all([(0,f.getDocs)(b),(0,f.getDocs)(c)]);Promise.all(Array.from(new Set([...e.docs.map(a=>a.id),...g.docs.map(a=>a.id)])).map(async a=>{let b=await (0,f.getDoc)((0,f.doc)(u,"users",a));return b.exists()?d(b,!1):null})).then(a=>{j(b=>{let c=new Set(b.filter(a=>a.isGroup).map(a=>a.id)),d=a.filter(Boolean).filter(a=>!c.has(a.id));return[...b.filter(a=>a.isGroup),...d].sort((a,b)=>(b.lastMessage?.createdAt?.toDate()||0)-(a.lastMessage?.createdAt?.toDate()||0))})})})(),()=>{c()}},[a]);let A=async()=>{if(0===w.size)return;let b=(0,f.writeBatch)(u);w.forEach(c=>{let d=(0,f.doc)(u,"users",a.uid,"deletedChats",c);b.set(d,{deletedAt:(0,f.serverTimestamp)()})}),await b.commit(),j(a=>a.filter(a=>!w.has(a.id))),B()},B=()=>{s(null),x(new Set)},C=h.filter(a=>a.name?.toLowerCase().includes(k.toLowerCase())||a.username?.toLowerCase().includes(k.toLowerCase()));return(0,b.jsxs)("div",{className:"flex h-screen w-full bg-transparent font-body text-white overflow-hidden relative",children:[(0,b.jsxs)("div",{className:"w-full md:w-1/3 md:min-w-[350px] border-r border-accent-cyan/10 bg-black/60 flex flex-col relative",children:[(0,b.jsx)(q.AnimatePresence,{children:"chats"===r?(0,b.jsxs)(p.motion.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},exit:{y:-50,opacity:0},className:"p-4 border-b border-accent-cyan/10 flex items-center justify-between shrink-0 bg-accent-cyan/10",children:[(0,b.jsx)("button",{onClick:B,children:(0,b.jsx)(n.X,{size:24})}),(0,b.jsxs)("span",{className:"font-bold",children:[w.size," selected"]}),(0,b.jsx)("button",{onClick:()=>{window.confirm(`Hide ${w.size} chat(s) from your list?`)&&A()},children:(0,b.jsx)(m.Trash2,{size:24})})]}):(0,b.jsxs)("div",{className:"p-4 border-b border-accent-cyan/10 flex items-center justify-between shrink-0",children:[(0,b.jsx)("h2",{className:"text-xl font-headline font-bold text-accent-cyan",children:"Signal"}),(0,b.jsx)(e.default,{href:"/signal/create-group",children:(0,b.jsx)(p.motion.button,{className:"btn-glass text-sm",whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},children:"Create Group"})})]})}),(0,b.jsx)("div",{className:"p-2",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("input",{type:"text",placeholder:"Search chats...",className:"input-glass w-full pl-10",value:k,onChange:a=>l(a.target.value)}),(0,b.jsx)(i.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:C.map(c=>(0,b.jsx)(v,{chat:c,selectionMode:r,isSelected:w.has(c.id),drafts:z,onClick:()=>(b=>{if("chats"===r){var c;let a;c=b.id,(a=new Set(w)).has(c)?a.delete(c):a.add(c),x(a),0===a.size&&s(null)}else{let c=b.isGroup?b.id:[a.uid,b.id].sort().join("_");y.push(`/signal/${c}`)}})(c),onLongPress:()=>{s("chats"),x(new Set([c.id]))}},c.id))})]}),(0,b.jsx)("div",{className:"hidden md:flex flex-1 items-center justify-center bg-black/40",children:(0,b.jsx)(t,{})})]})}function x(){let[a,d]=(0,c.useState)(null),[e,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{let a=g.auth.onAuthStateChanged(async a=>{if(a){d(a);let b=(0,f.doc)(u,"users",a.uid),c=await (0,f.getDoc)(b);c.exists()?h({...a,...c.data()}):h(a)}else d(null),h(null);j(!1)});return()=>a()},[]),!i&&a&&e)?(0,b.jsx)(w,{firebaseUser:a,userProfile:e}):(0,b.jsx)("div",{className:"flex h-screen items-center justify-center text-accent-cyan",children:"Loading Signal..."})}function y(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex h-screen items-center justify-center text-accent-cyan",children:"Loading Signal..."}),children:(0,b.jsx)(x,{})})}v.displayName="ChatItem",a.s(["default",()=>y],75596)}];

//# sourceMappingURL=_28174d96._.js.map