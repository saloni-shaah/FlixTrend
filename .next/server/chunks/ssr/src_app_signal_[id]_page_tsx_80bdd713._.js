module.exports=[77892,a=>{"use strict";let b,c,d,e;var f=a.i(87924),g=a.i(72131),h=a.i(50944);a.i(69387);var i=a.i(60574),j=a.i(25408),k=a.i(63519),l=a.i(64791),m=a.i(70106);let n=(0,m.default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);var o=a.i(4975),p=a.i(92759),q=a.i(210),r=a.i(38632),s=a.i(33508),t=a.i(7428),u=a.i(81560),v=a.i(60246);let w=(0,m.default)("circle-user",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);var x=a.i(13513),y=a.i(28193),z=a.i(43108),A=a.i(49094),B=a.i(46271),C=a.i(62036),D=a.i(74290),E=a.i(1703),F=a.i(702),G=a.i(57839),H=a.i(98241);function I(a,b){[...b].reverse().forEach(c=>{let d=a.getVariant(c);d&&(0,G.setTarget)(a,d),a.variantChildren&&a.variantChildren.forEach(a=>{I(a,b)})})}function J(){let a=!1,b=new Set,c={subscribe:a=>(b.add(a),()=>void b.delete(a)),start(c,d){(0,F.invariant)(a,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");let e=[];return b.forEach(a=>{e.push((0,H.animateVisualElement)(a,c,{transitionOverride:d}))}),Promise.all(e)},set:c=>((0,F.invariant)(a,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),b.forEach(a=>{var b,d;b=a,Array.isArray(d=c)?I(b,d):"string"==typeof d?I(b,[d]):(0,G.setTarget)(b,d)})),stop(){b.forEach(a=>{a.values.forEach(a=>a.stop())})},mount:()=>(a=!0,()=>{a=!1,c.stop()})};return c}let K=function(){let a=(0,D.useConstant)(J);return(0,E.useIsomorphicLayoutEffect)(a.mount,[]),a};var L=a.i(50104),M=a.i(70121),N=a.i(7554),O=a.i(92843),P=a.i(25152),Q=a.i(96743),R=a.i(22297),S=a.i(92616),T=a.i(77192),U=a.i(30553),V=a.i(86228),W=a.i(52081),X=a.i(41852),Y=Symbol("radix.slottable");function Z(a){return g.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===Y}var $="Dialog",[_,aa]=(0,L.createContextScope)($),[ab,ac]=_($),ad=a=>{let{__scopeDialog:b,children:c,open:d,defaultOpen:e,onOpenChange:h,modal:i=!0}=a,j=g.useRef(null),k=g.useRef(null),[l,m]=(0,P.useControllableState)({prop:d,defaultProp:e??!1,onChange:h,caller:$});return(0,f.jsx)(ab,{scope:b,triggerRef:j,contentRef:k,contentId:(0,O.useId)(),titleId:(0,O.useId)(),descriptionId:(0,O.useId)(),open:l,onOpenChange:m,onOpenToggle:g.useCallback(()=>m(a=>!a),[m]),modal:i,children:c})};ad.displayName=$;var ae="DialogTrigger",af=g.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=ac(ae,c),g=(0,M.useComposedRefs)(b,e.triggerRef);return(0,f.jsx)(U.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":e.open,"aria-controls":e.contentId,"data-state":az(e.open),...d,ref:g,onClick:(0,N.composeEventHandlers)(a.onClick,e.onOpenToggle)})});af.displayName=ae;var ag="DialogPortal",[ah,ai]=_(ag,{forceMount:void 0}),aj=a=>{let{__scopeDialog:b,forceMount:c,children:d,container:e}=a,h=ac(ag,b);return(0,f.jsx)(ah,{scope:b,forceMount:c,children:g.Children.map(d,a=>(0,f.jsx)(T.Presence,{present:c||h.open,children:(0,f.jsx)(S.Portal,{asChild:!0,container:e,children:a})}))})};aj.displayName=ag;var ak="DialogOverlay",al=g.forwardRef((a,b)=>{let c=ai(ak,a.__scopeDialog),{forceMount:d=c.forceMount,...e}=a,g=ac(ak,a.__scopeDialog);return g.modal?(0,f.jsx)(T.Presence,{present:d||g.open,children:(0,f.jsx)(an,{...e,ref:b})}):null});al.displayName=ak;var am=((e=g.forwardRef((a,b)=>{let{children:c,...d}=a;if(g.isValidElement(c)){var e;let a,f,h=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),i=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==g.Fragment&&(i.ref=b?(0,M.composeRefs)(b,h):h),g.cloneElement(c,i)}return g.Children.count(c)>1?g.Children.only(null):null})).displayName="DialogOverlay.RemoveScroll.SlotClone",b=e,(c=g.forwardRef((a,c)=>{let{children:d,...e}=a,h=g.Children.toArray(d),i=h.find(Z);if(i){let a=i.props.children,d=h.map(b=>b!==i?b:g.Children.count(a)>1?g.Children.only(null):g.isValidElement(a)?a.props.children:null);return(0,f.jsx)(b,{...e,ref:c,children:g.isValidElement(a)?g.cloneElement(a,void 0,d):null})}return(0,f.jsx)(b,{...e,ref:c,children:d})})).displayName="DialogOverlay.RemoveScroll.Slot",c),an=g.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=ac(ak,c);return(0,f.jsx)(W.RemoveScroll,{as:am,allowPinchZoom:!0,shards:[e.contentRef],children:(0,f.jsx)(U.Primitive.div,{"data-state":az(e.open),...d,ref:b,style:{pointerEvents:"auto",...d.style}})})}),ao="DialogContent",ap=g.forwardRef((a,b)=>{let c=ai(ao,a.__scopeDialog),{forceMount:d=c.forceMount,...e}=a,g=ac(ao,a.__scopeDialog);return(0,f.jsx)(T.Presence,{present:d||g.open,children:g.modal?(0,f.jsx)(aq,{...e,ref:b}):(0,f.jsx)(ar,{...e,ref:b})})});ap.displayName=ao;var aq=g.forwardRef((a,b)=>{let c=ac(ao,a.__scopeDialog),d=g.useRef(null),e=(0,M.useComposedRefs)(b,c.contentRef,d);return g.useEffect(()=>{let a=d.current;if(a)return(0,X.hideOthers)(a)},[]),(0,f.jsx)(as,{...a,ref:e,trapFocus:c.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,N.composeEventHandlers)(a.onCloseAutoFocus,a=>{a.preventDefault(),c.triggerRef.current?.focus()}),onPointerDownOutside:(0,N.composeEventHandlers)(a.onPointerDownOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey;(2===b.button||c)&&a.preventDefault()}),onFocusOutside:(0,N.composeEventHandlers)(a.onFocusOutside,a=>a.preventDefault())})}),ar=g.forwardRef((a,b)=>{let c=ac(ao,a.__scopeDialog),d=g.useRef(!1),e=g.useRef(!1);return(0,f.jsx)(as,{...a,ref:b,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),b.defaultPrevented||(d.current||c.triggerRef.current?.focus(),b.preventDefault()),d.current=!1,e.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||(d.current=!0,"pointerdown"===b.detail.originalEvent.type&&(e.current=!0));let f=b.target;c.triggerRef.current?.contains(f)&&b.preventDefault(),"focusin"===b.detail.originalEvent.type&&e.current&&b.preventDefault()}})}),as=g.forwardRef((a,b)=>{let{__scopeDialog:c,trapFocus:d,onOpenAutoFocus:e,onCloseAutoFocus:h,...i}=a,j=ac(ao,c),k=g.useRef(null),l=(0,M.useComposedRefs)(b,k);return(0,V.useFocusGuards)(),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(R.FocusScope,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:e,onUnmountAutoFocus:h,children:(0,f.jsx)(Q.DismissableLayer,{role:"dialog",id:j.contentId,"aria-describedby":j.descriptionId,"aria-labelledby":j.titleId,"data-state":az(j.open),...i,ref:l,onDismiss:()=>j.onOpenChange(!1)})}),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(aD,{titleId:j.titleId}),(0,f.jsx)(aE,{contentRef:k,descriptionId:j.descriptionId})]})]})}),at="DialogTitle",au=g.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=ac(at,c);return(0,f.jsx)(U.Primitive.h2,{id:e.titleId,...d,ref:b})});au.displayName=at;var av="DialogDescription",aw=g.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=ac(av,c);return(0,f.jsx)(U.Primitive.p,{id:e.descriptionId,...d,ref:b})});aw.displayName=av;var ax="DialogClose",ay=g.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=ac(ax,c);return(0,f.jsx)(U.Primitive.button,{type:"button",...d,ref:b,onClick:(0,N.composeEventHandlers)(a.onClick,()=>e.onOpenChange(!1))})});function az(a){return a?"open":"closed"}ay.displayName=ax;var aA="DialogTitleWarning",[aB,aC]=(0,L.createContext)(aA,{contentName:ao,titleName:at,docsSlug:"dialog"}),aD=({titleId:a})=>{let b=aC(aA),c=`\`${b.contentName}\` requires a \`${b.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${b.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${b.docsSlug}`;return g.useEffect(()=>{a&&(document.getElementById(a)||console.error(c))},[c,a]),null},aE=({contentRef:a,descriptionId:b})=>{let c=aC("DialogDescriptionWarning"),d=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${c.contentName}}.`;return g.useEffect(()=>{let c=a.current?.getAttribute("aria-describedby");b&&c&&(document.getElementById(b)||console.warn(d))},[d,a,b]),null},aF=Symbol("radix.slottable"),aG="AlertDialog",[aH,aI]=(0,L.createContextScope)(aG,[aa]),aJ=aa(),aK=a=>{let{__scopeAlertDialog:b,...c}=a,d=aJ(b);return(0,f.jsx)(ad,{...d,...c,modal:!0})};aK.displayName=aG,g.forwardRef((a,b)=>{let{__scopeAlertDialog:c,...d}=a,e=aJ(c);return(0,f.jsx)(af,{...e,...d,ref:b})}).displayName="AlertDialogTrigger";var aL=a=>{let{__scopeAlertDialog:b,...c}=a,d=aJ(b);return(0,f.jsx)(aj,{...d,...c})};aL.displayName="AlertDialogPortal";var aM=g.forwardRef((a,b)=>{let{__scopeAlertDialog:c,...d}=a,e=aJ(c);return(0,f.jsx)(al,{...e,...d,ref:b})});aM.displayName="AlertDialogOverlay";var aN="AlertDialogContent",[aO,aP]=aH(aN),aQ=((d=({children:a})=>(0,f.jsx)(f.Fragment,{children:a})).displayName="AlertDialogContent.Slottable",d.__radixId=aF,d),aR=g.forwardRef((a,b)=>{let{__scopeAlertDialog:c,children:d,...e}=a,h=aJ(c),i=g.useRef(null),j=(0,M.useComposedRefs)(b,i),k=g.useRef(null);return(0,f.jsx)(aB,{contentName:aN,titleName:aS,docsSlug:"alert-dialog",children:(0,f.jsx)(aO,{scope:c,cancelRef:k,children:(0,f.jsxs)(ap,{role:"alertdialog",...h,...e,ref:j,onOpenAutoFocus:(0,N.composeEventHandlers)(e.onOpenAutoFocus,a=>{a.preventDefault(),k.current?.focus({preventScroll:!0})}),onPointerDownOutside:a=>a.preventDefault(),onInteractOutside:a=>a.preventDefault(),children:[(0,f.jsx)(aQ,{children:d}),(0,f.jsx)(aZ,{contentRef:i})]})})})});aR.displayName=aN;var aS="AlertDialogTitle",aT=g.forwardRef((a,b)=>{let{__scopeAlertDialog:c,...d}=a,e=aJ(c);return(0,f.jsx)(au,{...e,...d,ref:b})});aT.displayName=aS;var aU="AlertDialogDescription",aV=g.forwardRef((a,b)=>{let{__scopeAlertDialog:c,...d}=a,e=aJ(c);return(0,f.jsx)(aw,{...e,...d,ref:b})});aV.displayName=aU;var aW=g.forwardRef((a,b)=>{let{__scopeAlertDialog:c,...d}=a,e=aJ(c);return(0,f.jsx)(ay,{...e,...d,ref:b})});aW.displayName="AlertDialogAction";var aX="AlertDialogCancel",aY=g.forwardRef((a,b)=>{let{__scopeAlertDialog:c,...d}=a,{cancelRef:e}=aP(aX,c),g=aJ(c),h=(0,M.useComposedRefs)(b,e);return(0,f.jsx)(ay,{...g,...d,ref:h})});aY.displayName=aX;var aZ=({contentRef:a})=>{let b=`\`${aN}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${aN}\` by passing a \`${aU}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${aN}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return g.useEffect(()=>{document.getElementById(a.current?.getAttribute("aria-describedby"))||console.warn(b)},[b,a]),null},a$=a.i(68114),a_=a.i(99570);let a0=g.forwardRef(({className:a,...b},c)=>(0,f.jsx)(aM,{className:(0,a$.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...b,ref:c}));a0.displayName=aM.displayName;let a1=g.forwardRef(({className:a,...b},c)=>(0,f.jsxs)(aL,{children:[(0,f.jsx)(a0,{}),(0,f.jsx)(aR,{ref:c,className:(0,a$.cn)("glass-card fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...b})]}));a1.displayName=aR.displayName;let a2=({className:a,...b})=>(0,f.jsx)("div",{className:(0,a$.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...b});a2.displayName="AlertDialogHeader";let a3=({className:a,...b})=>(0,f.jsx)("div",{className:(0,a$.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...b});a3.displayName="AlertDialogFooter";let a4=g.forwardRef(({className:a,...b},c)=>(0,f.jsx)(aT,{ref:c,className:(0,a$.cn)("text-lg font-semibold",a),...b}));a4.displayName=aT.displayName;let a5=g.forwardRef(({className:a,...b},c)=>(0,f.jsx)(aV,{ref:c,className:(0,a$.cn)("text-sm text-muted-foreground",a),...b}));a5.displayName=aV.displayName;let a6=g.forwardRef(({className:a,...b},c)=>(0,f.jsx)(aW,{ref:c,className:(0,a$.cn)((0,a_.buttonVariants)(),a),...b}));a6.displayName=aW.displayName;let a7=g.forwardRef(({className:a,...b},c)=>(0,f.jsx)(aY,{ref:c,className:(0,a$.cn)((0,a_.buttonVariants)({variant:"outline"}),"mt-2 sm:mt-0",a),...b}));a7.displayName=aY.displayName,a.i(60121);var a8=a.i(5420),a9=a.i(77156);let ba=(0,i.getFirestore)(j.app),bb=["Ram","Shyam","Sita","Mohan","Krishna","Radha","Anchal","Anaya","Advik","Diya","Rohan","Priya","Arjun","Saanvi","Kabir"],bc=g.default.memo(({msg:a,isUser:b,selectedChat:c,firebaseUser:d,isSelected:e,onLongPress:h,onClick:j,onShowEmojiPicker:k,showEmojiPicker:l,onShowDeleteConfirm:m,selectionMode:n})=>{var o,p;let q,r,s,v=((a,b=300)=>{let c=g.default.useRef(),d=()=>{c.current=setTimeout(a,b)},e=()=>{c.current&&clearTimeout(c.current)};return{onTouchStart:d,onTouchEnd:e,onMouseDown:d,onMouseUp:e,onMouseLeave:e}})(()=>{n?j():h()}),w=c.isGroup?"simple"===c.groupType?c.memberInfo?.[a.sender]:null:c,x="anonymous"===c.groupType?(o=a.sender,p=c.id,r=Math.abs((q=a=>{let b=0;for(let c=0;c<a.length;c++)b=Math.imul(31,b)+a.charCodeAt(c)|0;return b})(o+p))%bb.length,s=Math.abs(q(p+o))%900+100,`${bb[r]}${s}`):"pseudonymous"===c.groupType?c.pseudonyms?.[a.sender]||"Anon":w?.name||"User",y=async b=>{if(!d)return;let e=(0,i.doc)(ba,"chats",c.id,"messages",a.id),f={...a.reactions||{}},g=!1,h="";for(let[a,b]of Object.entries(f))if(Array.isArray(b)&&b.includes(d.uid)){g=!0,h=a;break}g&&h===b?(f[h]=f[h].filter(a=>a!==d.uid),0===f[h].length&&delete f[h]):(g&&(f[h]=f[h].filter(a=>a!==d.uid),0===f[h].length&&delete f[h]),f[b]||(f[b]=[]),f[b].push(d.uid)),await (0,i.updateDoc)(e,{reactions:f}),k(null)},z=(()=>{if(!b||"system"===a.sender)return"none";let e=c.isGroup?c.members.filter(a=>a!==d.uid):[c.id],f=a.readBy||[];return e.every(a=>f.includes(a))?"all_seen":f.length>1?"delivered":"sent"})();return(0,f.jsx)("div",{onClick:j,...v,className:(0,a$.cn)("group flex w-full items-end gap-2",b?"justify-end":"system"===a.sender?"justify-center":"justify-start","messages"===n&&"cursor-pointer"),children:(0,f.jsx)("div",{className:(0,a$.cn)("flex items-end gap-2 max-w-[80%] md:max-w-[70%]",e&&"bg-accent-cyan/20 rounded-xl"),children:(0,f.jsxs)("div",{className:`flex flex-col ${b?"items-end":"items-start"}`,children:[(0,f.jsxs)("div",{className:`relative px-4 py-2 rounded-2xl transition-all duration-300 ${b?"bg-accent-cyan text-white rounded-br-none":"system"===a.sender?"bg-gray-800 text-gray-400 text-xs italic":"bg-gray-700 text-white rounded-bl-none"}`,children:[!b&&"system"!==a.sender&&(0,f.jsx)("div",{className:"font-bold text-sm text-accent-pink",children:x}),"image"===a.type&&(0,f.jsx)("img",{src:a.mediaUrl,alt:a.text||"image",className:"rounded-lg max-w-xs mt-1"}),"video"===a.type&&(0,f.jsx)("video",{src:a.mediaUrl,controls:!0,className:"rounded-lg max-w-xs"}),"audio"===a.type&&(0,f.jsx)("audio",{src:a.mediaUrl,controls:!0}),a.text&&(0,f.jsx)("p",{className:"mt-1 break-words",children:a.text}),(0,f.jsxs)("div",{className:`text-xs mt-1 flex items-center gap-1 ${b?"justify-end":"justify-start"}`,children:[(0,f.jsx)("span",{children:a.createdAt?.toDate?.().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})||""}),"none"!==z&&(0,f.jsxs)("span",{className:"relative flex items-center",children:[(0,f.jsx)(a9.Eye,{size:14,className:(0,a$.cn)("transition-colors","all_seen"===z?"text-blue-400":"text-gray-500")}),"all_seen"===z&&(0,f.jsx)(a9.Eye,{size:14,className:"absolute -right-1 text-blue-400"})]})]}),a.reactions&&Object.keys(a.reactions).length>0&&(0,f.jsx)("div",{className:"absolute -bottom-4 -right-1 flex gap-1",children:Object.entries(a.reactions).map(([a,b])=>(0,f.jsxs)("div",{className:"bg-gray-600 px-1.5 py-0.5 rounded-full text-xs flex items-center gap-1",children:[(0,f.jsx)("span",{children:a}),(0,f.jsx)("span",{className:"font-bold text-xs",children:Array.isArray(b)?b.length:0})]},a))})]}),(0,f.jsxs)("div",{className:`relative hidden group-hover:flex items-center gap-1 mt-1 ${b?"flex-row-reverse":""}`,children:["system"!==a.sender&&(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)("button",{onClick:()=>k(l===a.id?null:a.id),className:"p-1 rounded-full bg-gray-600 hover:bg-gray-500",children:(0,f.jsx)(t.Smile,{size:16})}),(0,f.jsx)(C.AnimatePresence,{children:l===a.id&&(0,f.jsx)(B.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute z-10 -top-10 bg-gray-800 rounded-full p-2 flex gap-1 shadow-lg",children:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜¢","ðŸ˜®","ðŸ™"].map(a=>(0,f.jsx)("button",{onClick:()=>y(a),className:"text-xl hover:scale-125 transition-transform",children:a},a))})})]})}),b&&(0,f.jsx)("button",{onClick:m,className:"p-1 rounded-full bg-gray-600 hover:bg-red-500",children:(0,f.jsx)(u.Trash2,{size:16})})]})]})})},a.id)});bc.displayName="MessageItem";let bd=g.forwardRef(({className:a,...b},c)=>(0,f.jsx)("textarea",{className:(0,a$.cn)("flex min-h-[40px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","bg-transparent border-2 border-glass-border focus:ring-accent-green focus:border-accent-green",a),ref:c,...b}));bd.displayName="Textarea";let be=(0,i.getFirestore)(j.app),bf=(0,a8.getStorage)(j.app);function bg({firebaseUser:a,userProfile:b,chatId:c}){let d,e,m=(0,h.useRouter)(),{drafts:D,setDraft:E}=(0,A.useAppState)(),[F,G]=(0,g.useState)(null),[H,I]=(0,g.useState)([]),[J,L]=(0,g.useState)(""),M=(0,g.useRef)(null),N=(0,g.useRef)(null),O=(0,g.useRef)(null),[P,Q]=(0,g.useState)(!1),[R,S]=(0,g.useState)(!1),[T,U]=(0,g.useState)(0),V=(0,g.useRef)(null),W=(0,g.useRef)([]),X=(0,g.useRef)(null),Y=(0,g.useRef)(null),Z=K(),[$,_]=(0,g.useState)(null),[aa,ab]=(0,g.useState)(new Set),[ac,ad]=(0,g.useState)(!1),[ae,af]=(0,g.useState)(null),ag=(0,g.useRef)(null),[ah,ai]=(0,g.useState)(!1),[aj,ak]=(0,g.useState)(!1),al=(0,g.useRef)(null),am=(0,g.useRef)(null),[an,ao]=(0,g.useState)(!1),[ap,aq]=(0,g.useState)(null),[ar,as]=(0,g.useState)(null),[at,au]=(0,g.useState)(null);(0,g.useEffect)(()=>{L(D[c]||"")},[c,D]),(0,g.useEffect)(()=>{let b;if(!c||!a)return;if(c.includes("_")){let d=c.replace(a.uid,"").replace("_","");b=(0,i.onSnapshot)((0,i.doc)(be,"users",d),a=>{a.exists()&&G({id:a.id,...a.data(),isGroup:!1})})}else b=(0,i.onSnapshot)((0,i.doc)(be,"groups",c),a=>{a.exists()&&G({id:a.id,...a.data(),isGroup:!0})});let d=(0,i.query)((0,i.collection)(be,"chats",c,"messages"),(0,i.orderBy)("createdAt","asc")),e=(0,i.onSnapshot)(d,b=>{let d=b.docs.map(a=>({id:a.id,...a.data()})),e=d.filter(b=>b.sender!==a.uid&&!(b.readBy||[]).includes(a.uid));if(e.length>0){let b=(0,i.writeBatch)(be);e.forEach(d=>{let e=(0,i.doc)(be,"chats",c,"messages",d.id);b.update(e,{readBy:(0,i.arrayUnion)(a.uid)})}),b.commit().catch(a=>console.error("Error marking messages as read:",a))}I(d)});return()=>{b(),e()}},[c,a]),(0,g.useEffect)(()=>{M.current?.scrollIntoView({behavior:"smooth"})},[H]);let av=async()=>{try{let a=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});au(a),al.current&&(al.current.srcObject=a)}catch(a){console.error("Camera error:",a),alert("Camera access denied. Please enable it in your browser settings."),ak(!1)}},aw=()=>{at&&(at.getTracks().forEach(a=>a.stop()),au(null))};(0,g.useEffect)(()=>(aj?av():aw(),aw),[aj]);let ax=async(b,d=null,e="text")=>{if(b?.preventDefault(),!J.trim()&&!d||!a||!F)return;let f=J.trim();L(""),E(c,""),O.current&&(O.current.style.height="auto"),ag.current&&clearTimeout(ag.current);let g={sender:a.uid,createdAt:(0,i.serverTimestamp)(),type:e,readBy:[a.uid],reactions:{},deletedFor:[]};d?(g.mediaUrl=d,f&&(g.text=f)):g.text=f,await (0,i.addDoc)((0,i.collection)(be,"chats",c,"messages"),g)},ay=async b=>{if(0===aa.size)return;let d=(0,i.writeBatch)(be);aa.forEach(e=>{let f=(0,i.doc)(be,"chats",c,"messages",e);"me"===b?d.update(f,{deletedFor:(0,i.arrayUnion)(a.uid)}):d.delete(f)});try{await d.commit()}catch(a){console.error("Error deleting messages:",a),alert("Could not delete messages.")}finally{az()}},az=()=>{_(null),ab(new Set)},aA=async(a,b)=>{let c=j.auth.currentUser;if(!c)return void aq("You must be logged in to upload files.");if(!a.type.startsWith("image/"))return void aq("Only images can be sent in chat.");if(a.size>5242880)return void aq("Image size cannot exceed 5MB.");ao(!0),aq("");let d=null;b||as(d=URL.createObjectURL(a));try{let d="audio"===b?`voice_messages/${c.uid}`:`chat_media/${c.uid}`,e=`${Date.now()}-${a.name}`,f=(0,a8.ref)(bf,`${d}/${e}`),g=await (0,a8.uploadBytes)(f,a),h=await (0,a8.getDownloadURL)(g.ref),i=b||(a.type.startsWith("video/")?"video":"image");await ax(void 0,h,i)}catch(a){console.error("Upload failed:",a),aq(a.message)}finally{ao(!1),d&&(URL.revokeObjectURL(d),as(null))}},aB=async()=>{try{let a=await navigator.mediaDevices.getUserMedia({audio:!0});V.current=new MediaRecorder(a),W.current=[],V.current.ondataavailable=a=>{W.current.push(a.data)},V.current.onstop=async()=>{let b=new Blob(W.current,{type:"audio/webm"});if(b.size>5242880){aq("Voice message is too large (max 5MB)."),a.getTracks().forEach(a=>a.stop());return}let c=new File([b],`voice-message-${Date.now()}.webm`,{type:"audio/webm"});await aA(c,"audio"),a.getTracks().forEach(a=>a.stop())},V.current.start(),Q(!0),U(0),X.current=setInterval(()=>{U(a=>a+1)},1e3)}catch(a){console.error("Audio recording failed:",a),aq("Microphone access denied.")}};return aj?(0,f.jsxs)("div",{className:"absolute inset-0 z-20 bg-black flex flex-col items-center justify-center",children:[(0,f.jsx)("video",{ref:al,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,f.jsx)("canvas",{ref:am,className:"hidden"}),(0,f.jsxs)("div",{className:"absolute bottom-4 flex items-center gap-4",children:[(0,f.jsx)("button",{onClick:()=>ak(!1),className:"p-3 bg-gray-800/70 rounded-full text-white",children:(0,f.jsx)(s.X,{})}),(0,f.jsx)("button",{onClick:()=>{if(al.current&&am.current){let a=al.current,b=am.current;b.width=a.videoWidth,b.height=a.videoHeight;let c=b.getContext("2d");c?.drawImage(a,0,0,a.videoWidth,a.videoHeight),b.toBlob(async a=>{if(a){let b=new File([a],`capture-${Date.now()}.jpg`,{type:"image/jpeg"});ak(!1),await aA(b)}},"image/jpeg")}},className:"w-20 h-20 rounded-full bg-white border-4 border-gray-400"})]})]}):F?(0,f.jsxs)("div",{className:"flex-1 flex flex-col bg-black/40 h-full",children:[(0,f.jsxs)("header",{className:"flex items-center gap-3 p-3 border-b border-accent-cyan/10 bg-black/60 shadow-md shrink-0",children:[(0,f.jsx)("button",{onClick:()=>m.push("/signal"),className:"p-2 rounded-full hover:bg-accent-cyan/10",children:(0,f.jsx)(q.ArrowLeft,{size:20})}),(0,f.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-tr from-accent-pink to-accent-cyan flex items-center justify-center text-white font-bold text-lg overflow-hidden shrink-0",children:F.isGroup?F.avatar_url?(0,f.jsx)("img",{src:F.avatar_url,alt:F.name,className:"w-full h-full object-cover"}):(0,f.jsx)(v.Users,{}):F.avatar_url?(0,f.jsx)("img",{src:F.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):(0,f.jsx)(w,{})}),(0,f.jsx)("div",{className:"flex-1 text-left",children:(0,f.jsx)("h3",{className:"font-bold text-white",children:F.name||F.username})}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[!F.isGroup&&(0,f.jsx)("button",{className:"p-2 rounded-full hover:bg-accent-cyan/10",children:(0,f.jsx)(l.Video,{size:20})}),!F.isGroup&&(0,f.jsx)("button",{className:"p-2 rounded-full hover:bg-accent-cyan/10",children:(0,f.jsx)(k.Phone,{size:20})})]})]}),(0,f.jsx)(C.AnimatePresence,{children:"messages"===$&&(0,f.jsxs)(B.motion.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"p-3 border-b border-accent-cyan/10 flex items-center justify-between shrink-0 bg-accent-cyan/10 fixed top-[65px] left-0 right-0 z-10 md:left-1/3",children:[(0,f.jsx)("button",{onClick:az,children:(0,f.jsx)(s.X,{size:24})}),(0,f.jsxs)("span",{className:"font-bold",children:[aa.size," selected"]}),(0,f.jsx)("button",{onClick:()=>ad(!0),children:(0,f.jsx)(u.Trash2,{size:24})})]})}),(0,f.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-1",children:[(d=null,e=[],H.filter(b=>!(b.deletedFor||[]).includes(a.uid)).forEach(b=>{let c=b.createdAt?.toDate();if(c){let a=c.toDateString();if(a!==d){let b,g,h,i;e.push((0,f.jsx)("div",{className:"text-center my-4",children:(0,f.jsx)("span",{className:"bg-gray-800 text-gray-400 text-xs font-bold px-3 py-1 rounded-full",children:((h=new Date(g=new Date((b=new Date).getFullYear(),b.getMonth(),b.getDate()))).setDate(h.getDate()-1),(i=new Date(c.getFullYear(),c.getMonth(),c.getDate())).getTime()===g.getTime()?"Today":i.getTime()===h.getTime()?"Yesterday":c.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))})},a)),d=a}}let g=b.sender===a.uid;e.push((0,f.jsx)(bc,{msg:b,isUser:g,selectedChat:F,firebaseUser:a,isSelected:aa.has(b.id),selectionMode:$,onLongPress:()=>{_("messages"),ab(new Set([b.id]))},onClick:()=>{if("messages"===$){let a=new Set(aa);a.has(b.id)?a.delete(b.id):a.add(b.id),ab(a),0===a.size&&az()}},onShowEmojiPicker:af,showEmojiPicker:ae,onShowDeleteConfirm:()=>{ab(new Set([b.id])),ad(!0)}},b.id))}),e),(0,f.jsx)("div",{ref:M})]}),(0,f.jsxs)("footer",{className:"shrink-0 p-2 border-t border-accent-cyan/10 bg-black/60 relative",children:[(0,f.jsx)(C.AnimatePresence,{children:ah&&(0,f.jsxs)(B.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute bottom-full left-2 w-48 bg-gray-800 rounded-lg shadow-lg p-2 flex flex-col gap-1",children:[(0,f.jsxs)("button",{type:"button",onClick:()=>{ai(!1),ak(!0)},className:"btn-glass text-sm justify-start gap-2 text-white",children:[(0,f.jsx)(x.Camera,{})," Take Photo"]}),(0,f.jsxs)("button",{type:"button",onClick:()=>N.current?.click(),className:"btn-glass text-sm justify-start gap-2 text-white",children:[(0,f.jsx)(r.Image,{})," Upload Image"]})]})}),(0,f.jsxs)("form",{onSubmit:a=>ax(a),className:"flex items-end gap-2",children:[!R&&(0,f.jsxs)("div",{className:"flex items-center",children:[(0,f.jsx)("button",{type:"button",onClick:()=>ai(a=>!a),className:"p-2 text-gray-400 hover:text-accent-cyan shrink-0",children:(0,f.jsx)(n,{size:20})}),(0,f.jsx)("button",{type:"button",className:"p-2 text-gray-400 hover:text-accent-cyan shrink-0",onClick:()=>{O.current?.focus();try{O.current&&"showPicker"in HTMLInputElement.prototype&&O.current.showPicker()}catch(a){console.warn("Could not programmatically open emoji keyboard.")}},children:(0,f.jsx)(t.Smile,{size:20})})]}),R?(0,f.jsxs)("div",{className:"flex-1 flex items-center gap-3 bg-gray-700 rounded-full px-4 py-2",children:[(0,f.jsx)("button",{type:"button",onClick:()=>{V.current&&P&&(V.current.onstop=()=>{V.current?.stream.getTracks().forEach(a=>a.stop())},V.current.stop()),X.current&&clearInterval(X.current),Q(!1),S(!1)},className:"text-red-400",children:"Cancel"}),(0,f.jsxs)("div",{className:"flex-1 text-center text-red-400 animate-pulse font-mono",children:[Math.floor(T/60).toString().padStart(2,"0"),":",(T%60).toString().padStart(2,"0")]})]}):(0,f.jsx)("div",{className:"flex-1 relative flex items-center",children:(0,f.jsx)(bd,{ref:O,value:J,onChange:b=>{let d=b.target.value;if(L(d),O.current&&(O.current.style.height="auto",O.current.style.height=`${O.current.scrollHeight}px`),F){E(c,d),ag.current&&clearTimeout(ag.current);let b=(0,i.doc)(be,F.isGroup?"groups":"users",F.id);(0,i.updateDoc)(b,{typing:(0,i.arrayUnion)(a.uid)}).catch(()=>{}),ag.current=setTimeout(()=>{(0,i.updateDoc)(b,{typing:(0,i.arrayRemove)(a.uid)}).catch(()=>{})},3e3)}},onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||ax(a)},placeholder:P?"Recording...":"Type a message...",className:"flex-1 bg-gray-700 rounded-xl px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-accent-cyan w-full pr-10 resize-none max-h-32",rows:1})}),(0,f.jsx)("input",{type:"file",ref:N,onChange:a=>{ai(!1);let b=a.target.files?.[0];b&&aA(b),a.target&&(a.target.value="")},className:"hidden",accept:"image/*"}),(0,f.jsx)(C.AnimatePresence,{mode:"wait",children:""!==J.trim()||R?(0,f.jsx)(B.motion.button,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},type:"submit",className:"p-3 rounded-full bg-accent-cyan text-black shrink-0",children:(0,f.jsx)(p.Send,{size:20})},"send"):(0,f.jsxs)("div",{className:"relative",children:[(0,f.jsx)(B.motion.div,{id:"lock-icon",className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 p-2 bg-gray-800 rounded-full pointer-events-none",animate:Z,initial:{y:-100,opacity:0},children:(0,f.jsx)(z.Lock,{size:20})}),(0,f.jsx)(B.motion.button,{ref:Y,onTouchStart:a=>{a.preventDefault(),Z.start({y:0,opacity:1}),aB()},onTouchEnd:()=>{Z.start({y:-100,opacity:0}),R||(V.current&&P&&V.current.stop(),X.current&&clearInterval(X.current),Q(!1),S(!1))},onTouchMove:a=>{let b=a.touches[0],c=document.getElementById("lock-icon");if(c){let{top:a,right:d,bottom:e,left:f}=c.getBoundingClientRect();b.clientX>f&&b.clientX<d&&b.clientY>a&&b.clientY<e&&(S(!0),V.current&&P&&Z.start({y:-100,opacity:0}))}},animate:{scale:P?1.2:1},type:"button",className:`p-3 rounded-full transition-colors shrink-0 ${P?"bg-red-500 animate-pulse":"bg-accent-pink text-white"}`,children:(0,f.jsx)(o.Mic,{size:20})},"mic")]})})]})]}),(0,f.jsx)(aK,{open:ac,onOpenChange:ad,children:(0,f.jsxs)(a1,{children:[(0,f.jsxs)(a2,{children:[(0,f.jsx)(a4,{children:"Delete Message(s)?"}),(0,f.jsx)(a5,{children:"This action cannot be undone."})]}),(0,f.jsxs)(a3,{children:[(0,f.jsx)(a7,{children:"Cancel"}),(0,f.jsx)(a6,{onClick:()=>ay("me"),className:"bg-yellow-600 hover:bg-yellow-700",children:"Delete for Me"}),(0,f.jsx)(a6,{onClick:()=>ay("everyone"),className:"bg-red-600 hover:bg-red-700",children:"Delete for Everyone"})]})]})})]}):(0,f.jsxs)("div",{className:"flex h-full w-full items-center justify-center text-accent-cyan",children:[(0,f.jsx)(y.Loader,{className:"animate-spin"})," Loading Chat..."]})}function bh(){let a=(0,h.useParams)().id,[b,c]=(0,g.useState)(null),[d,e]=(0,g.useState)(null),[k,l]=(0,g.useState)(!0),m=(0,h.useRouter)();return((0,g.useEffect)(()=>{let a=j.auth.onAuthStateChanged(async a=>{if(a){c(a);let b=(0,i.doc)(be,"users",a.uid),d=(0,i.onSnapshot)(b,b=>{b.exists()?e({...a,...b.data()}):e(a),l(!1)});return()=>d()}m.push("/login"),l(!1)});return()=>a()},[m]),!k&&b&&d)?(0,f.jsx)(bg,{firebaseUser:b,userProfile:d,chatId:a}):(0,f.jsxs)("div",{className:"flex h-full items-center justify-center text-accent-cyan",children:[(0,f.jsx)(y.Loader,{className:"animate-spin"})," Loading Chat..."]})}function bi(){return(0,f.jsx)("div",{className:"h-full w-full",children:(0,f.jsx)(g.Suspense,{fallback:(0,f.jsxs)("div",{className:"flex h-full items-center justify-center text-accent-cyan",children:[(0,f.jsx)(y.Loader,{className:"animate-spin"})," Loading Chat..."]}),children:(0,f.jsx)(bh,{})})})}a.s(["default",()=>bi],77892)}];

//# sourceMappingURL=src_app_signal_%5Bid%5D_page_tsx_80bdd713._.js.map