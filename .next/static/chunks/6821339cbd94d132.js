(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,89013,e=>{"use strict";let t,r,n;var o=e.i(43476),a=e.i(71645);e.i(36180);var s=e.i(98925),l=e.i(11152),i=e.i(2008),d=e.i(46897),c=e.i(97960),u=e.i(75254);let p=(0,u.default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),f=(0,u.default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),m=(0,u.default)("trash",[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);var x=e.i(86536),h=e.i(61059),v=e.i(22016),g=e.i(46932);e.i(27260),e.i(61978);var w=e.i(52831),b=e.i(39312),y=e.i(81140),j=e.i(20783),C=e.i(30030),N=e.i(69340),k=e.i(48425),R=e.i(75830),E=a.createContext(void 0);function D(e){let t=a.useContext(E);return e||t||"ltr"}var S=e.i(26330),M=e.i(3536),P=e.i(65491),I=e.i(10772),_=e.i(53660),T=e.i(74606),A=e.i(96626),F=e.i(30207),O="rovingFocusGroup.onEntryFocus",L={bubbles:!1,cancelable:!0},H="RovingFocusGroup",[U,K,V]=(0,R.createCollection)(H),[z,G]=(0,C.createContextScope)(H,[V]),[$,B]=z(H),q=a.forwardRef((e,t)=>(0,o.jsx)(U.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,o.jsx)(U.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,o.jsx)(X,{...e,ref:t})})}));q.displayName=H;var X=a.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,orientation:n,loop:s=!1,dir:l,currentTabStopId:i,defaultCurrentTabStopId:d,onCurrentTabStopIdChange:c,onEntryFocus:u,preventScrollOnEntryFocus:p=!1,...f}=e,m=a.useRef(null),x=(0,j.useComposedRefs)(t,m),h=D(l),[v,g]=(0,N.useControllableState)({prop:i,defaultProp:d??null,onChange:c,caller:H}),[w,b]=a.useState(!1),C=(0,F.useCallbackRef)(u),R=K(r),E=a.useRef(!1),[S,M]=a.useState(0);return a.useEffect(()=>{let e=m.current;if(e)return e.addEventListener(O,C),()=>e.removeEventListener(O,C)},[C]),(0,o.jsx)($,{scope:r,orientation:n,dir:h,loop:s,currentTabStopId:v,onItemFocus:a.useCallback(e=>g(e),[g]),onItemShiftTab:a.useCallback(()=>b(!0),[]),onFocusableItemAdd:a.useCallback(()=>M(e=>e+1),[]),onFocusableItemRemove:a.useCallback(()=>M(e=>e-1),[]),children:(0,o.jsx)(k.Primitive.div,{tabIndex:w||0===S?-1:0,"data-orientation":n,...f,ref:x,style:{outline:"none",...e.style},onMouseDown:(0,y.composeEventHandlers)(e.onMouseDown,()=>{E.current=!0}),onFocus:(0,y.composeEventHandlers)(e.onFocus,e=>{let t=!E.current;if(e.target===e.currentTarget&&t&&!w){let t=new CustomEvent(O,L);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=R().filter(e=>e.focusable);Z([e.find(e=>e.active),e.find(e=>e.id===v),...e].filter(Boolean).map(e=>e.ref.current),p)}}E.current=!1}),onBlur:(0,y.composeEventHandlers)(e.onBlur,()=>b(!1))})})}),Y="RovingFocusGroupItem",W=a.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,focusable:n=!0,active:s=!1,tabStopId:l,children:i,...d}=e,c=(0,I.useId)(),u=l||c,p=B(Y,r),f=p.currentTabStopId===u,m=K(r),{onFocusableItemAdd:x,onFocusableItemRemove:h,currentTabStopId:v}=p;return a.useEffect(()=>{if(n)return x(),()=>h()},[n,x,h]),(0,o.jsx)(U.ItemSlot,{scope:r,id:u,focusable:n,active:s,children:(0,o.jsx)(k.Primitive.span,{tabIndex:f?0:-1,"data-orientation":p.orientation,...d,ref:t,onMouseDown:(0,y.composeEventHandlers)(e.onMouseDown,e=>{n?p.onItemFocus(u):e.preventDefault()}),onFocus:(0,y.composeEventHandlers)(e.onFocus,()=>p.onItemFocus(u)),onKeyDown:(0,y.composeEventHandlers)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void p.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=function(e,t,r){var n;let o=(n=e.key,"rtl"!==r?n:"ArrowLeft"===n?"ArrowRight":"ArrowRight"===n?"ArrowLeft":n);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(o))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(o)))return J[o]}(e,p.orientation,p.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let o=m().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)o.reverse();else if("prev"===t||"next"===t){var r,n;"prev"===t&&o.reverse();let a=o.indexOf(e.currentTarget);o=p.loop?(r=o,n=a+1,r.map((e,t)=>r[(n+t)%r.length])):o.slice(a+1)}setTimeout(()=>Z(o))}}),children:"function"==typeof i?i({isCurrentTabStop:f,hasTabStop:null!=v}):i})})});W.displayName=Y;var J={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Z(e,t=!1){let r=document.activeElement;for(let n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}var Q=Symbol("radix.slottable");function ee(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Q}var et=e.i(86312),er=e.i(85369),en=["Enter"," "],eo=["ArrowUp","PageDown","End"],ea=["ArrowDown","PageUp","Home",...eo],es={ltr:[...en,"ArrowRight"],rtl:[...en,"ArrowLeft"]},el={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ei="Menu",[ed,ec,eu]=(0,R.createCollection)(ei),[ep,ef]=(0,C.createContextScope)(ei,[eu,_.createPopperScope,G]),em=(0,_.createPopperScope)(),ex=G(),[eh,ev]=ep(ei),[eg,ew]=ep(ei),eb=e=>{let{__scopeMenu:t,open:r=!1,children:n,dir:s,onOpenChange:l,modal:i=!0}=e,d=em(t),[c,u]=a.useState(null),p=a.useRef(!1),f=(0,F.useCallbackRef)(l),m=D(s);return a.useEffect(()=>{let e=()=>{p.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>p.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,o.jsx)(_.Root,{...d,children:(0,o.jsx)(eh,{scope:t,open:r,onOpenChange:f,content:c,onContentChange:u,children:(0,o.jsx)(eg,{scope:t,onClose:a.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:p,dir:m,modal:i,children:n})})})};eb.displayName=ei;var ey=a.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e,a=em(r);return(0,o.jsx)(_.Anchor,{...a,...n,ref:t})});ey.displayName="MenuAnchor";var ej="MenuPortal",[eC,eN]=ep(ej,{forceMount:void 0}),ek=e=>{let{__scopeMenu:t,forceMount:r,children:n,container:a}=e,s=ev(ej,t);return(0,o.jsx)(eC,{scope:t,forceMount:r,children:(0,o.jsx)(A.Presence,{present:r||s.open,children:(0,o.jsx)(T.Portal,{asChild:!0,container:a,children:n})})})};ek.displayName=ej;var eR="MenuContent",[eE,eD]=ep(eR),eS=a.forwardRef((e,t)=>{let r=eN(eR,e.__scopeMenu),{forceMount:n=r.forceMount,...a}=e,s=ev(eR,e.__scopeMenu),l=ew(eR,e.__scopeMenu);return(0,o.jsx)(ed.Provider,{scope:e.__scopeMenu,children:(0,o.jsx)(A.Presence,{present:n||s.open,children:(0,o.jsx)(ed.Slot,{scope:e.__scopeMenu,children:l.modal?(0,o.jsx)(eM,{...a,ref:t}):(0,o.jsx)(eP,{...a,ref:t})})})})}),eM=a.forwardRef((e,t)=>{let r=ev(eR,e.__scopeMenu),n=a.useRef(null),s=(0,j.useComposedRefs)(t,n);return a.useEffect(()=>{let e=n.current;if(e)return(0,et.hideOthers)(e)},[]),(0,o.jsx)(e_,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:(0,y.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),eP=a.forwardRef((e,t)=>{let r=ev(eR,e.__scopeMenu);return(0,o.jsx)(e_,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),eI=((n=a.forwardRef((e,t)=>{let{children:r,...n}=e;if(a.isValidElement(r)){var o;let e,s,l=(o=r,(s=(e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?o.ref:(s=(e=Object.getOwnPropertyDescriptor(o,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?o.props.ref:o.props.ref||o.ref),i=function(e,t){let r={...t};for(let n in t){let o=e[n],a=t[n];/^on[A-Z]/.test(n)?o&&a?r[n]=(...e)=>{let t=a(...e);return o(...e),t}:o&&(r[n]=o):"style"===n?r[n]={...o,...a}:"className"===n&&(r[n]=[o,a].filter(Boolean).join(" "))}return{...e,...r}}(n,r.props);return r.type!==a.Fragment&&(i.ref=t?(0,j.composeRefs)(t,l):l),a.cloneElement(r,i)}return a.Children.count(r)>1?a.Children.only(null):null})).displayName="MenuContent.ScrollLock.SlotClone",t=n,(r=a.forwardRef((e,r)=>{let{children:n,...s}=e,l=a.Children.toArray(n),i=l.find(ee);if(i){let e=i.props.children,n=l.map(t=>t!==i?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,o.jsx)(t,{...s,ref:r,children:a.isValidElement(e)?a.cloneElement(e,void 0,n):null})}return(0,o.jsx)(t,{...s,ref:r,children:n})})).displayName="MenuContent.ScrollLock.Slot",r),e_=a.forwardRef((e,t)=>{let{__scopeMenu:r,loop:n=!1,trapFocus:s,onOpenAutoFocus:l,onCloseAutoFocus:i,disableOutsidePointerEvents:d,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:m,onDismiss:x,disableOutsideScroll:h,...v}=e,g=ev(eR,r),w=ew(eR,r),b=em(r),C=ex(r),N=ec(r),[k,R]=a.useState(null),E=a.useRef(null),D=(0,j.useComposedRefs)(t,E,g.onContentChange),I=a.useRef(0),T=a.useRef(""),A=a.useRef(0),F=a.useRef(null),O=a.useRef("right"),L=a.useRef(0),H=h?er.RemoveScroll:a.Fragment;a.useEffect(()=>()=>window.clearTimeout(I.current),[]),(0,M.useFocusGuards)();let U=a.useCallback(e=>{var t,r;return O.current===F.current?.side&&(t=e,!!(r=F.current?.area)&&function(e,t){let{x:r,y:n}=e,o=!1;for(let e=0,a=t.length-1;e<t.length;a=e++){let s=t[e],l=t[a],i=s.x,d=s.y,c=l.x,u=l.y;d>n!=u>n&&r<(c-i)*(n-d)/(u-d)+i&&(o=!o)}return o}({x:t.clientX,y:t.clientY},r))},[]);return(0,o.jsx)(eE,{scope:r,searchRef:T,onItemEnter:a.useCallback(e=>{U(e)&&e.preventDefault()},[U]),onItemLeave:a.useCallback(e=>{U(e)||(E.current?.focus(),R(null))},[U]),onTriggerLeave:a.useCallback(e=>{U(e)&&e.preventDefault()},[U]),pointerGraceTimerRef:A,onPointerGraceIntentChange:a.useCallback(e=>{F.current=e},[]),children:(0,o.jsx)(H,{...h?{as:eI,allowPinchZoom:!0}:void 0,children:(0,o.jsx)(P.FocusScope,{asChild:!0,trapped:s,onMountAutoFocus:(0,y.composeEventHandlers)(l,e=>{e.preventDefault(),E.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:(0,o.jsx)(S.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:d,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:m,onDismiss:x,children:(0,o.jsx)(q,{asChild:!0,...C,dir:w.dir,orientation:"vertical",loop:n,currentTabStopId:k,onCurrentTabStopIdChange:R,onEntryFocus:(0,y.composeEventHandlers)(c,e=>{w.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,o.jsx)(_.Content,{role:"menu","aria-orientation":"vertical","data-state":e5(g.open),"data-radix-menu-content":"",dir:w.dir,...b,...v,ref:D,style:{outline:"none",...v.style},onKeyDown:(0,y.composeEventHandlers)(v.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,r=e.ctrlKey||e.altKey||e.metaKey,n=1===e.key.length;if(t){var o;let t,a,s,l,i,d;"Tab"===e.key&&e.preventDefault(),!r&&n&&(o=e.key,t=T.current+o,a=N().filter(e=>!e.disabled),s=document.activeElement,l=a.find(e=>e.ref.current===s)?.textValue,i=function(e,t,r){var n;let o=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,a=r?e.indexOf(r):-1,s=(n=Math.max(a,0),e.map((t,r)=>e[(n+r)%e.length]));1===o.length&&(s=s.filter(e=>e!==r));let l=s.find(e=>e.toLowerCase().startsWith(o.toLowerCase()));return l!==r?l:void 0}(a.map(e=>e.textValue),t,l),d=a.find(e=>e.textValue===i)?.ref.current,function e(t){T.current=t,window.clearTimeout(I.current),""!==t&&(I.current=window.setTimeout(()=>e(""),1e3))}(t),d&&setTimeout(()=>d.focus()))}let a=E.current;if(e.target!==a||!ea.includes(e.key))return;e.preventDefault();let s=N().filter(e=>!e.disabled).map(e=>e.ref.current);eo.includes(e.key)&&s.reverse(),function(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}(s)}),onBlur:(0,y.composeEventHandlers)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(I.current),T.current="")}),onPointerMove:(0,y.composeEventHandlers)(e.onPointerMove,e9(e=>{let t=e.target,r=L.current!==e.clientX;e.currentTarget.contains(t)&&r&&(O.current=e.clientX>L.current?"right":"left",L.current=e.clientX)}))})})})})})})});eS.displayName=eR;var eT=a.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,o.jsx)(k.Primitive.div,{role:"group",...n,ref:t})});eT.displayName="MenuGroup";var eA=a.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,o.jsx)(k.Primitive.div,{...n,ref:t})});eA.displayName="MenuLabel";var eF="MenuItem",eO="menu.itemSelect",eL=a.forwardRef((e,t)=>{let{disabled:r=!1,onSelect:n,...s}=e,l=a.useRef(null),i=ew(eF,e.__scopeMenu),d=eD(eF,e.__scopeMenu),c=(0,j.useComposedRefs)(t,l),u=a.useRef(!1);return(0,o.jsx)(eH,{...s,ref:c,disabled:r,onClick:(0,y.composeEventHandlers)(e.onClick,()=>{let e=l.current;if(!r&&e){let t=new CustomEvent(eO,{bubbles:!0,cancelable:!0});e.addEventListener(eO,e=>n?.(e),{once:!0}),(0,k.dispatchDiscreteCustomEvent)(e,t),t.defaultPrevented?u.current=!1:i.onClose()}}),onPointerDown:t=>{e.onPointerDown?.(t),u.current=!0},onPointerUp:(0,y.composeEventHandlers)(e.onPointerUp,e=>{u.current||e.currentTarget?.click()}),onKeyDown:(0,y.composeEventHandlers)(e.onKeyDown,e=>{let t=""!==d.searchRef.current;r||t&&" "===e.key||en.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});eL.displayName=eF;var eH=a.forwardRef((e,t)=>{let{__scopeMenu:r,disabled:n=!1,textValue:s,...l}=e,i=eD(eF,r),d=ex(r),c=a.useRef(null),u=(0,j.useComposedRefs)(t,c),[p,f]=a.useState(!1),[m,x]=a.useState("");return a.useEffect(()=>{let e=c.current;e&&x((e.textContent??"").trim())},[l.children]),(0,o.jsx)(ed.ItemSlot,{scope:r,disabled:n,textValue:s??m,children:(0,o.jsx)(W,{asChild:!0,...d,focusable:!n,children:(0,o.jsx)(k.Primitive.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...l,ref:u,onPointerMove:(0,y.composeEventHandlers)(e.onPointerMove,e9(e=>{n?i.onItemLeave(e):(i.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:(0,y.composeEventHandlers)(e.onPointerLeave,e9(e=>i.onItemLeave(e))),onFocus:(0,y.composeEventHandlers)(e.onFocus,()=>f(!0)),onBlur:(0,y.composeEventHandlers)(e.onBlur,()=>f(!1))})})})}),eU=a.forwardRef((e,t)=>{let{checked:r=!1,onCheckedChange:n,...a}=e;return(0,o.jsx)(eX,{scope:e.__scopeMenu,checked:r,children:(0,o.jsx)(eL,{role:"menuitemcheckbox","aria-checked":e6(r)?"mixed":r,...a,ref:t,"data-state":e8(r),onSelect:(0,y.composeEventHandlers)(a.onSelect,()=>n?.(!!e6(r)||!r),{checkForDefaultPrevented:!1})})})});eU.displayName="MenuCheckboxItem";var eK="MenuRadioGroup",[eV,ez]=ep(eK,{value:void 0,onValueChange:()=>{}}),eG=a.forwardRef((e,t)=>{let{value:r,onValueChange:n,...a}=e,s=(0,F.useCallbackRef)(n);return(0,o.jsx)(eV,{scope:e.__scopeMenu,value:r,onValueChange:s,children:(0,o.jsx)(eT,{...a,ref:t})})});eG.displayName=eK;var e$="MenuRadioItem",eB=a.forwardRef((e,t)=>{let{value:r,...n}=e,a=ez(e$,e.__scopeMenu),s=r===a.value;return(0,o.jsx)(eX,{scope:e.__scopeMenu,checked:s,children:(0,o.jsx)(eL,{role:"menuitemradio","aria-checked":s,...n,ref:t,"data-state":e8(s),onSelect:(0,y.composeEventHandlers)(n.onSelect,()=>a.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});eB.displayName=e$;var eq="MenuItemIndicator",[eX,eY]=ep(eq,{checked:!1}),eW=a.forwardRef((e,t)=>{let{__scopeMenu:r,forceMount:n,...a}=e,s=eY(eq,r);return(0,o.jsx)(A.Presence,{present:n||e6(s.checked)||!0===s.checked,children:(0,o.jsx)(k.Primitive.span,{...a,ref:t,"data-state":e8(s.checked)})})});eW.displayName=eq;var eJ=a.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,o.jsx)(k.Primitive.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});eJ.displayName="MenuSeparator";var eZ=a.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e,a=em(r);return(0,o.jsx)(_.Arrow,{...a,...n,ref:t})});eZ.displayName="MenuArrow";var[eQ,e0]=ep("MenuSub"),e1="MenuSubTrigger",e2=a.forwardRef((e,t)=>{let r=ev(e1,e.__scopeMenu),n=ew(e1,e.__scopeMenu),s=e0(e1,e.__scopeMenu),l=eD(e1,e.__scopeMenu),i=a.useRef(null),{pointerGraceTimerRef:d,onPointerGraceIntentChange:c}=l,u={__scopeMenu:e.__scopeMenu},p=a.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return a.useEffect(()=>p,[p]),a.useEffect(()=>{let e=d.current;return()=>{window.clearTimeout(e),c(null)}},[d,c]),(0,o.jsx)(ey,{asChild:!0,...u,children:(0,o.jsx)(eH,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":e5(r.open),...e,ref:(0,j.composeRefs)(t,s.onTriggerChange),onClick:t=>{e.onClick?.(t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:(0,y.composeEventHandlers)(e.onPointerMove,e9(t=>{l.onItemEnter(t),!t.defaultPrevented&&(e.disabled||r.open||i.current||(l.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),p()},100)))})),onPointerLeave:(0,y.composeEventHandlers)(e.onPointerLeave,e9(e=>{p();let t=r.content?.getBoundingClientRect();if(t){let n=r.content?.dataset.side,o="right"===n,a=t[o?"left":"right"],s=t[o?"right":"left"];l.onPointerGraceIntentChange({area:[{x:e.clientX+(o?-5:5),y:e.clientY},{x:a,y:t.top},{x:s,y:t.top},{x:s,y:t.bottom},{x:a,y:t.bottom}],side:n}),window.clearTimeout(d.current),d.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(e),e.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:(0,y.composeEventHandlers)(e.onKeyDown,t=>{let o=""!==l.searchRef.current;e.disabled||o&&" "===t.key||es[n.dir].includes(t.key)&&(r.onOpenChange(!0),r.content?.focus(),t.preventDefault())})})})});e2.displayName=e1;var e3="MenuSubContent",e4=a.forwardRef((e,t)=>{let r=eN(eR,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,l=ev(eR,e.__scopeMenu),i=ew(eR,e.__scopeMenu),d=e0(e3,e.__scopeMenu),c=a.useRef(null),u=(0,j.useComposedRefs)(t,c);return(0,o.jsx)(ed.Provider,{scope:e.__scopeMenu,children:(0,o.jsx)(A.Presence,{present:n||l.open,children:(0,o.jsx)(ed.Slot,{scope:e.__scopeMenu,children:(0,o.jsx)(e_,{id:d.contentId,"aria-labelledby":d.triggerId,...s,ref:u,align:"start",side:"rtl"===i.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{i.isUsingKeyboardRef.current&&c.current?.focus(),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,y.composeEventHandlers)(e.onFocusOutside,e=>{e.target!==d.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:(0,y.composeEventHandlers)(e.onEscapeKeyDown,e=>{i.onClose(),e.preventDefault()}),onKeyDown:(0,y.composeEventHandlers)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),r=el[i.dir].includes(e.key);t&&r&&(l.onOpenChange(!1),d.trigger?.focus(),e.preventDefault())})})})})})});function e5(e){return e?"open":"closed"}function e6(e){return"indeterminate"===e}function e8(e){return e6(e)?"indeterminate":e?"checked":"unchecked"}function e9(e){return t=>"mouse"===t.pointerType?e(t):void 0}e4.displayName=e3;var e7="DropdownMenu",[te,tt]=(0,C.createContextScope)(e7,[ef]),tr=ef(),[tn,to]=te(e7),ta=e=>{let{__scopeDropdownMenu:t,children:r,dir:n,open:s,defaultOpen:l,onOpenChange:i,modal:d=!0}=e,c=tr(t),u=a.useRef(null),[p,f]=(0,N.useControllableState)({prop:s,defaultProp:l??!1,onChange:i,caller:e7});return(0,o.jsx)(tn,{scope:t,triggerId:(0,I.useId)(),triggerRef:u,contentId:(0,I.useId)(),open:p,onOpenChange:f,onOpenToggle:a.useCallback(()=>f(e=>!e),[f]),modal:d,children:(0,o.jsx)(eb,{...c,open:p,onOpenChange:f,dir:n,modal:d,children:r})})};ta.displayName=e7;var ts="DropdownMenuTrigger",tl=a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,disabled:n=!1,...a}=e,s=to(ts,r),l=tr(r);return(0,o.jsx)(ey,{asChild:!0,...l,children:(0,o.jsx)(k.Primitive.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...a,ref:(0,j.composeRefs)(t,s.triggerRef),onPointerDown:(0,y.composeEventHandlers)(e.onPointerDown,e=>{!n&&0===e.button&&!1===e.ctrlKey&&(s.onOpenToggle(),s.open||e.preventDefault())}),onKeyDown:(0,y.composeEventHandlers)(e.onKeyDown,e=>{!n&&(["Enter"," "].includes(e.key)&&s.onOpenToggle(),"ArrowDown"===e.key&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});tl.displayName=ts;var ti=e=>{let{__scopeDropdownMenu:t,...r}=e,n=tr(t);return(0,o.jsx)(ek,{...n,...r})};ti.displayName="DropdownMenuPortal";var td="DropdownMenuContent",tc=a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,s=to(td,r),l=tr(r),i=a.useRef(!1);return(0,o.jsx)(eS,{id:s.contentId,"aria-labelledby":s.triggerId,...l,...n,ref:t,onCloseAutoFocus:(0,y.composeEventHandlers)(e.onCloseAutoFocus,e=>{i.current||s.triggerRef.current?.focus(),i.current=!1,e.preventDefault()}),onInteractOutside:(0,y.composeEventHandlers)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;(!s.modal||n)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});tc.displayName=td,a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eT,{...a,...n,ref:t})}).displayName="DropdownMenuGroup",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eA,{...a,...n,ref:t})}).displayName="DropdownMenuLabel";var tu=a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eL,{...a,...n,ref:t})});tu.displayName="DropdownMenuItem",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eU,{...a,...n,ref:t})}).displayName="DropdownMenuCheckboxItem",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eG,{...a,...n,ref:t})}).displayName="DropdownMenuRadioGroup",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eB,{...a,...n,ref:t})}).displayName="DropdownMenuRadioItem",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eW,{...a,...n,ref:t})}).displayName="DropdownMenuItemIndicator",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eJ,{...a,...n,ref:t})}).displayName="DropdownMenuSeparator",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(eZ,{...a,...n,ref:t})}).displayName="DropdownMenuArrow",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(e2,{...a,...n,ref:t})}).displayName="DropdownMenuSubTrigger",a.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=tr(r);return(0,o.jsx)(e4,{...a,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}).displayName="DropdownMenuSubContent";var tp=e.i(75157),tf=e.i(48893),tm=e.i(90883);e.i(47167);var tx=e.i(31779),th=e.i(82373),tv=e.i(35116),tg=e.i(61911);function tw({streamPost:e}){let[t,r]=(0,a.useState)(null),[n,s]=(0,a.useState)(null),[l,i]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),[u,p]=(0,a.useState)(0),f=(0,a.useRef)(null),m=h.auth.currentUser;return(0,a.useEffect)(()=>{if(!m||!e)return void i("Stream information is missing.");let t=e.livekitRoom,r=m.uid,n=m.displayName||m.email||"Viewer";(async()=>{try{let e=await fetch("/api/livekit-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomName:t,identity:r,name:n,isStreamer:!1})}),o=await e.json();if(o.error)throw Error(o.error);s(o.token)}catch(e){console.error("Error getting LiveKit token for viewer:",e),i("Could not connect to the stream.")}})()},[m,e]),(0,a.useEffect)(()=>{if(n){let e=new tx.Room;return r(e),e.on("trackSubscribed",(e,t,r)=>{"video"===e.kind&&f.current&&e.attach(f.current)}),e.on("participantConnected",()=>p(e.numParticipants+1)),e.on("participantDisconnected",()=>p(e.numParticipants+1)),(async()=>{try{await e.connect("wss://flixtrend-vobztfm3.livekit.cloud",n),p(e.numParticipants+1)}catch(e){console.error("Failed to connect as viewer",e),i("Stream not found or has ended.")}})(),()=>{e.disconnect()}}},[n]),(0,o.jsxs)("div",{className:"relative w-full h-full bg-black rounded-xl overflow-hidden",children:[(0,o.jsx)("video",{ref:f,autoPlay:!0,playsInline:!0,muted:d,className:"w-full h-full object-contain"}),l&&(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-red-500 bg-black/70",children:l}),(0,o.jsxs)("div",{className:"absolute top-2 left-2 flex items-center gap-4",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-black/50 rounded-lg",children:[(0,o.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,o.jsx)("span",{className:"text-white font-bold text-sm",children:"LIVE"})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-black/50 rounded-lg text-white text-sm",children:[(0,o.jsx)(tg.Users,{size:16}),(0,o.jsx)("span",{children:u})]})]}),(0,o.jsx)("div",{className:"absolute bottom-2 right-2 flex items-center gap-2",children:(0,o.jsx)("button",{onClick:()=>c(e=>!e),className:"p-2 bg-black/50 rounded-full text-white",children:d?(0,o.jsx)(tv.VolumeX,{size:18}):(0,o.jsx)(th.Volume2,{size:18})})})]})}var tb=e.i(74911);let ty=(0,w.getFunctions)(h.app),tj=(0,w.httpsCallable)(ty,"updatePost");function tC({post:e,onClose:t}){let[r,n]=(0,a.useState)(e.content||""),[s,l]=(0,a.useState)(!1),[i,d]=(0,a.useState)(""),{toast:c}=(0,tb.useToast)(),u=async n=>{n.preventDefault(),l(!0),d("");try{await tj({postId:e.id,newData:{content:r}}),c({title:"Post Updated",description:"Your post has been successfully updated."}),t()}catch(e){d(e.message)}finally{l(!1)}};return(0,o.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:(0,o.jsxs)(g.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"glass-card p-6 w-full max-w-lg relative flex flex-col",children:[(0,o.jsx)("button",{onClick:t,className:"absolute top-4 right-4 text-gray-400 hover:text-white",children:"×"}),(0,o.jsx)("h2",{className:"text-xl font-headline font-bold mb-4 text-accent-cyan",children:"Edit Post"}),(0,o.jsxs)("form",{onSubmit:u,className:"flex flex-col gap-4",children:[(0,o.jsx)("textarea",{name:"content",className:"input-glass w-full min-h-[150px] rounded-2xl",value:r,onChange:e=>n(e.target.value)}),i&&(0,o.jsx)("p",{className:"text-red-400 text-sm mt-2 text-center",children:i}),(0,o.jsxs)("div",{className:"flex justify-end gap-3 mt-4",children:[(0,o.jsx)("button",{type:"button",className:"btn-glass",onClick:t,children:"Cancel"}),(0,o.jsx)("button",{type:"submit",className:"btn-glass bg-accent-pink text-white",disabled:s,children:s?"Saving...":"Save Changes"})]})]})]})})}let tN=a.default.forwardRef(({className:e,sideOffset:t=4,...r},n)=>(0,o.jsx)(ti,{children:(0,o.jsx)(tc,{ref:n,sideOffset:t,className:(0,tp.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","glass-card",e),...r})}));tN.displayName=tc.displayName;let tk=a.default.forwardRef(({className:e,inset:t,...r},n)=>(0,o.jsx)(tu,{ref:n,className:(0,tp.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:pointer-events-none [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",e),...r}));tk.displayName=tu.displayName;let tR=(0,s.getFirestore)(h.app),tE=(0,w.getFunctions)(h.app),tD=e=>{if(!e)return"Just now";let t=e.toDate?e.toDate():new Date(e);if(isNaN(t.getTime()))return"Just now";let r=new Date,n=Math.floor((r.getTime()-t.getTime())/1e3),o=n/86400;if(n<10)return"Just now";if(n<60)return`${Math.floor(n)}s ago`;if(n<3600)return`${Math.floor(n/60)}m ago`;if(n<86400)return`${Math.floor(n/3600)}h ago`;if(o<2)return"Yesterday";if(o<=7)return`${Math.floor(o)}d ago`;let a={month:"short",day:"numeric"};return t.getFullYear()!==r.getFullYear()&&(a.year="numeric"),t.toLocaleDateString("en-US",a)};function tS({post:e,isShortVibe:t=!1}){let r,n,u,[y,j]=a.default.useState(!1),[C,N]=a.default.useState(!1),[k,R]=a.default.useState({}),[E,D]=a.default.useState(null),[S,M]=(0,a.useState)(e.viewCount||0),P=h.auth.currentUser,I=(0,w.httpsCallable)(tE,"deletePost");a.default.useEffect(()=>{if(!P||"poll"!==e.type||!e.pollOptions)return;let t=(0,s.onSnapshot)((0,s.collection)(tR,"posts",e.id,"pollVotes"),t=>{let r={};e.pollOptions.forEach((e,t)=>{r[t]={count:0,voters:[]}});let n=null;t.forEach(e=>{let{optionIdx:t,userId:o}=e.data();r[t]&&(r[t].count++,r[t].voters.push(o)),o===P.uid&&(n=t)}),R(r),D(n)});return()=>t()},[e.id,P,e.type,e.pollOptions]),(0,a.useEffect)(()=>{let t=(0,s.doc)(tR,"posts",e.id),r=(0,s.onSnapshot)(t,e=>{e.exists()&&M(e.data().viewCount||0)});return()=>r()},[e.id]);let _=async()=>{if(window.confirm("Are you sure you want to permanently delete this post and all its interactions? This cannot be undone."))try{await I({postId:e.id}),alert(`Post ${e.id} has been successfully deleted.`)}catch(e){alert(`Failed to delete post: ${e.message}`)}},T=async t=>{P&&null===E&&await (0,s.setDoc)((0,s.doc)(tR,"posts",e.id,"pollVotes",P.uid),{userId:P.uid,optionIdx:t,createdAt:(0,s.serverTimestamp)()})};return t?(0,o.jsxs)("div",{className:"absolute inset-0 w-full h-full p-4 pr-8 flex items-end justify-between pointer-events-none bg-gradient-to-t from-black/60 via-black/20 to-transparent",children:[(0,o.jsxs)("div",{className:"flex-1 flex flex-col gap-2 self-end text-white drop-shadow-lg max-w-[calc(100%-80px)] pointer-events-auto",children:[(0,o.jsxs)(v.default,{href:`/squad/${e.userId}`,className:"flex items-center gap-2 group cursor-pointer w-fit",children:[(0,o.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-tr from-accent-pink to-accent-green flex items-center justify-center font-bold text-lg overflow-hidden border-2 border-accent-green group-hover:scale-105 transition-transform",children:e.avatar_url?(0,o.jsx)("img",{src:e.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):(0,o.jsx)("span",{className:"text-white",children:e.displayName?.[0]||"U"})}),(0,o.jsxs)("span",{className:"font-headline text-white text-base group-hover:underline",children:["@",e.username||"user"]})]}),(0,o.jsx)("p",{className:"text-white text-sm font-body line-clamp-3",children:e.content}),e.song&&(0,o.jsxs)("div",{className:"flex items-center gap-2 text-white text-sm",children:[(0,o.jsx)(l.FaMusic,{})," ",(0,o.jsxs)("span",{children:[e.song.name," - ",e.song.artists.join(", ")]})]})]}),(0,o.jsx)("div",{className:"flex flex-col gap-4 self-end pointer-events-auto",children:(0,o.jsx)(tm.PostActions,{post:e,isShortVibe:!0,onCommentClick:()=>j(!0)})}),y&&(0,o.jsx)(tM,{postId:e.id,postAuthorId:e.userId,onClose:()=>j(!1),post:e})]}):(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(g.motion.div,{className:"glass-card p-5 flex flex-col gap-3 relative",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},viewport:{once:!0,amount:.2},transition:{duration:.5,ease:"easeOut"},children:["relay"===e.type&&(0,o.jsxs)("div",{className:"text-xs text-muted-foreground font-bold mb-2 flex items-center gap-2",children:[(0,o.jsx)(i.Repeat2,{size:14})," Relayed by ",(0,o.jsxs)(v.default,{href:`/squad/${e.userId}`,className:"text-accent-cyan hover:underline",children:["@",e.username]})]}),C&&(0,o.jsx)(tC,{post:e,onClose:()=>N(!1)}),(r="relay"===e.type?e.originalPost:e,n=r.displayName?.split(" ").map(e=>e[0]).join("").slice(0,2).toUpperCase()||r.username?.slice(0,2).toUpperCase()||"U",u=Array.isArray(r.mediaUrl)?r.mediaUrl:r.mediaUrl?[r.mediaUrl]:[],(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,o.jsxs)(v.default,{href:`/squad/${r.userId}`,className:"flex items-center gap-2 group cursor-pointer",children:[(0,o.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-tr from-accent-pink to-accent-green flex items-center justify-center font-bold text-lg overflow-hidden border-2 border-accent-green group-hover:scale-105 transition-transform",children:r.avatar_url?(0,o.jsx)("img",{src:r.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):(0,o.jsx)("span",{className:"text-white",children:n})}),(0,o.jsxs)("span",{className:"font-headline text-accent-green text-sm group-hover:underline",children:["@",r.username||"user"]})]}),(0,o.jsxs)("div",{className:"ml-auto flex items-center gap-3 text-xs text-muted-foreground",children:[(0,o.jsx)("span",{children:tD(r.createdAt)}),(r.isVideo||"live"===r.type)&&(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)(x.Eye,{size:14})," ",S.toLocaleString()]}),P?.uid===r.userId&&!t&&(0,o.jsxs)(ta,{children:[(0,o.jsx)(tl,{asChild:!0,children:(0,o.jsx)("button",{className:"p-1 rounded-full hover:bg-white/10",children:(0,o.jsx)(p,{size:16})})}),(0,o.jsxs)(tN,{className:"glass-card",children:[(0,o.jsxs)(tk,{onClick:()=>N(!0),children:[(0,o.jsx)(f,{})," Edit Post"]}),(0,o.jsxs)(tk,{onClick:_,className:"text-red-400 focus:bg-red-500/20 focus:text-red-300",children:[(0,o.jsx)(m,{})," Delete Post"]})]})]})]})]}),"live"===r.type&&r.livekitRoom&&"live"===r.status&&(0,o.jsx)("div",{className:"w-full aspect-video rounded-xl overflow-hidden mt-2",children:(0,o.jsx)(tw,{streamPost:r})}),r.content&&("poll"!==r.type||"poll"===r.type&&!r.pollOptions)&&(0,o.jsx)("div",{className:`whitespace-pre-line mb-2 px-4 py-3 rounded-xl ${t?"text-white text-base font-body line-clamp-2 text-left":"text-[1.15rem] font-body"}`,style:{backgroundColor:r.backgroundColor&&!t?r.backgroundColor:"transparent",color:r.backgroundColor&&"#ffffff"!==r.backgroundColor&&!t?"hsl(var(--foreground))":"inherit",textShadow:t?"0 1px 4px #000":"none"},children:r.content}),(0,o.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-gray-400 my-2",children:[r.location&&(0,o.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,o.jsx)(d.MapPin,{size:14})," ",r.location]}),r.mood&&(0,o.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,o.jsx)(c.Smile,{size:14})," Feeling ",r.mood]})]}),r.hashtags&&r.hashtags.length>0&&!t&&(0,o.jsx)("div",{className:"flex flex-wrap gap-2",children:r.hashtags.map(e=>(0,o.jsxs)(v.default,{href:`/tags/${e}`,className:"text-brand-gold font-bold text-sm hover:underline",children:["#",e]},e))}),"media"===r.type&&u.length>0&&!t&&(0,o.jsx)(tf.InFeedVideoPlayer,{mediaUrls:u,post:r}),"poll"===r.type&&r.pollOptions&&(0,o.jsxs)("div",{className:"flex flex-col gap-2 p-4",children:[(0,o.jsx)("div",{className:"font-bold text-brand-gold mb-3",children:r.content}),r.pollOptions.map((e,t)=>{let r=k[t]||{count:0,voters:[]},n=Object.values(k).reduce((e,t)=>e+t.count,0),a=n>0?Math.round(r.count/n*100):0;return(0,o.jsxs)("button",{className:"w-full p-2 rounded-full font-bold transition-all relative overflow-hidden btn-glass",onClick:()=>T(t),disabled:null!==E,children:[null!==E&&(0,o.jsx)("div",{className:"absolute left-0 top-0 h-full bg-brand-gold/50",style:{width:`${a}%`}}),(0,o.jsxs)("div",{className:"relative flex justify-between z-10 px-2",children:[(0,o.jsx)("span",{children:e}),null!==E&&(0,o.jsxs)("span",{children:[a,"% (",r.count,")"]})]})]},t)})]}),r.song&&(0,o.jsxs)("div",{className:"mt-2 p-3 rounded-xl bg-black/20 flex items-center gap-4 border border-glass-border",children:[(0,o.jsx)("img",{src:r.song.albumArt,alt:r.song.album,className:"w-12 h-12 rounded-lg"}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("div",{className:"font-bold text-brand-gold text-base line-clamp-1",children:r.song.name}),(0,o.jsx)("div",{className:"text-xs text-muted-foreground mb-1 line-clamp-1",children:r.song.artists.join(", ")})]}),(0,o.jsx)(v.default,{href:`/create?type=flash&songId=${r.song.id}`,className:"p-2 rounded-full bg-accent-pink/20 text-accent-pink hover:bg-accent-pink/40 hover:text-white transition-colors",children:(0,o.jsx)(b.Zap,{size:14})})]})]})),(0,o.jsx)(tm.PostActions,{post:e,onCommentClick:()=>j(!0)}),y&&(0,o.jsx)(tM,{postId:e.id,postAuthorId:e.userId,onClose:()=>j(!1),post:e})]})})}function tM({postId:e,postAuthorId:t,onClose:r,post:n}){let[l,i]=a.default.useState([]);return a.default.useEffect(()=>{let t=(0,s.query)((0,s.collection)(tR,"posts",e,"comments"),(0,s.orderBy)("createdAt","asc")),r=(0,s.onSnapshot)(t,e=>{i(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>r()},[e]),(0,o.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:(0,o.jsxs)("div",{className:"glass-card p-6 w-full max-w-md relative flex flex-col",children:[(0,o.jsx)("button",{onClick:r,className:"absolute top-2 right-2 text-accent-pink text-2xl",children:"×"}),(0,o.jsx)("h3",{className:"text-xl font-headline font-bold mb-4 text-brand-gold",children:"Comments"}),(0,o.jsx)("div",{className:"flex flex-col gap-3 max-h-60 overflow-y-auto mb-4 p-2",children:0===l.length?(0,o.jsx)("div",{className:"text-muted-foreground text-center",children:"No comments yet. Be the first!"}):l.map(e=>(0,o.jsx)(tP,{comment:e},e.id))}),(0,o.jsx)(tI,{postId:e,postAuthorId:t,onCommentPosted:()=>{},post:n})]})})}function tP({comment:e}){let[t,r]=a.default.useState(null);a.default.useEffect(()=>{!async function(){if(e.userId){let t=await (0,s.getDoc)((0,s.doc)(tR,"users",e.userId));if(t.exists()){let e=t.data();r({username:e.username,avatar_url:e.avatar_url,displayName:e.name})}else r({username:"deleted_user",displayName:"Deleted User",avatar_url:null})}}()},[e.userId]);let n=t?.displayName?.split(" ").map(e=>e[0]).join("").slice(0,2).toUpperCase()||t?.username?.slice(0,2).toUpperCase()||"U";return(0,o.jsxs)("div",{className:"flex gap-3",children:[(0,o.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-tr from-accent-pink to-accent-green flex items-center justify-center font-bold text-sm overflow-hidden shrink-0",children:t?.avatar_url?(0,o.jsx)("img",{src:t.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):(0,o.jsx)("span",{className:"text-white",children:n})}),(0,o.jsx)("div",{className:"flex-1",children:(0,o.jsxs)("div",{className:"rounded-xl px-3 py-2 font-body",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsxs)(v.default,{href:`/squad/${e.userId}`,className:"font-bold text-brand-gold text-sm hover:underline",children:["@",t?.username||"user"]}),(0,o.jsx)("span",{className:"text-xs text-muted-foreground",children:tD(e.createdAt)})]}),(0,o.jsx)("p",{className:"text-base",children:e.text})]})})]})}function tI({postId:e,postAuthorId:t,onCommentPosted:r,post:n}){let[l,i]=a.default.useState(""),[d,c]=a.default.useState(!1),u=h.auth.currentUser,p=async n=>{if(n.preventDefault(),!l.trim()||!u)return;c(!0);let o=await (0,s.getDoc)((0,s.doc)(tR,"users",u.uid)),a=o.exists()?o.data():{},d=a.name||u.displayName||"Anonymous",p=a.username||u.displayName||"anonymous",f=a.avatar_url||u.photoURL||null,m={text:l,userId:u.uid,displayName:d,username:p,avatar_url:f,createdAt:(0,s.serverTimestamp)()};if(await (0,s.addDoc)((0,s.collection)(tR,"posts",e,"comments"),m),t!==u.uid){let r=(0,s.collection)(tR,"users",t,"notifications");await (0,s.addDoc)(r,{type:"comment",fromUserId:u.uid,fromUsername:p,fromAvatarUrl:f,postId:e,postContent:l.substring(0,50),createdAt:(0,s.serverTimestamp)(),read:!1})}i(""),c(!1),r()};return(0,o.jsxs)("form",{onSubmit:p,className:"flex gap-2",children:[(0,o.jsx)("input",{type:"text",className:"input-glass flex-1",placeholder:"Add a comment...",value:l,onChange:e=>i(e.target.value),disabled:d}),(0,o.jsx)("button",{type:"submit",className:"btn-glass px-4",disabled:d||!l.trim(),children:"Post"})]})}e.s(["PostCard",()=>tS],89013)}]);