(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23497,e=>{"use strict";var t=e.i(43476),l=e.i(71645),s=e.i(27260),r=e.i(20641),i=e.i(37727),n=e.i(14764);e.i(36180);var a=e.i(98925),c=e.i(61059),u=e.i(95762);let o=(0,a.getFirestore)(c.app),d=({isAnimated:e=!1})=>(0,t.jsxs)("div",{className:`absolute flex items-center gap-1.5 bg-black/40 text-white py-1 px-2 rounded-full text-xs pointer-events-none z-10 ${e?"animate-[float-watermark_10s_ease-in-out_infinite]":"bottom-2 right-2"}`,children:[(0,t.jsx)(s.FlixTrendLogo,{size:16}),(0,t.jsx)("span",{className:"font-bold",children:"FlixTrend"})]});function f({onSkip:e}){let[s,n]=(0,l.useState)(5);return(0,l.useEffect)(()=>{if(s<=0)return;let e=setTimeout(()=>n(e=>e-1),1e3);return()=>clearTimeout(e)},[s]),(0,t.jsxs)("div",{className:"w-full h-full bg-black flex flex-col items-center justify-center relative",children:[(0,t.jsx)("div",{className:"absolute top-4 right-4 z-10",children:s>0?(0,t.jsxs)("span",{className:"text-white bg-black/50 rounded-full px-3 py-1 text-sm",children:["Skip in ",s]}):(0,t.jsxs)("button",{onClick:e,className:"text-white bg-black/50 rounded-full px-4 py-2 text-sm flex items-center gap-2",children:["Skip Ad ",(0,t.jsx)(i.X,{size:16})]})}),(0,t.jsx)("div",{className:"w-full max-w-sm",children:(0,t.jsx)(r.default,{})}),(0,t.jsx)("p",{className:"text-xs text-gray-500 absolute bottom-4",children:"This is a sponsored message."})]})}function m({flash:e,currentUser:s,onClose:r}){let[i,c]=(0,l.useState)(""),u=async t=>{if(!t.trim()||!s||!e)return;let l=[s.uid,e.userId].sort().join("_");await (0,a.addDoc)((0,a.collection)(o,"chats",l,"messages"),{text:t,sender:s.uid,createdAt:(0,a.serverTimestamp)(),type:"flash_reply",readBy:[s.uid],flash_preview:{mediaUrl:e.mediaUrl,caption:e.caption||""}}),r()};return(0,t.jsxs)("div",{className:"absolute bottom-4 left-4 right-4 z-20 flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"Send a message...",className:"input-glass flex-1 text-sm",onKeyDown:e=>{"Enter"===e.key&&i.trim()&&u(i)}}),(0,t.jsx)("button",{onClick:()=>u(i),disabled:!i.trim(),className:"p-3 rounded-full bg-accent-cyan text-black disabled:bg-gray-600",children:(0,t.jsx)(n.Send,{size:16})}),(0,t.jsx)("div",{className:"flex gap-1",children:["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥","ðŸ‘"].map(e=>(0,t.jsx)("button",{className:"text-2xl hover:scale-125 transition-transform",onClick:()=>u(e),children:e},e))})]})}function h({userFlashes:e,onClose:s}){let[r,i]=(0,l.useState)(0),[n,a]=(0,l.useState)(0),[o,h]=(0,l.useState)(0),[x,p]=(0,l.useState)(!1),[g,b]=(0,l.useState)(0),j=(0,l.useRef)(null),v=(0,l.useRef)(null),w=(0,l.useRef)(null),y=(0,l.useRef)(0),{setSelectedChat:N}=(0,u.useAppState)(),k=c.auth.currentUser,T=Array.isArray(e)?e:[e],U=()=>{s(T[r]?.userId)},S=(0,l.useCallback)(()=>{if((o+1)%9==0&&o>0){p(!0),h(0);return}h(e=>e+1),n<T[r].flashes.length-1?a(e=>e+1):r<T.length-1?(i(e=>e+1),a(0)):U()},[T,n,r,U,o,9]),A=(0,l.useCallback)(()=>{if(n>0)a(e=>e-1);else if(r>0){let e=r-1;i(e),a(T[e].flashes.length-1)}},[T,n,r]);if((0,l.useEffect)(()=>{if(x){w.current&&clearTimeout(w.current),v.current&&v.current.pause();return}let e=T[r]?.flashes[n];if(!e)return;let t=e.mediaUrl&&(e.mediaUrl.includes(".mp4")||e.mediaUrl.includes(".webm")||e.mediaUrl.includes(".ogg"));if(b(0),w.current&&clearTimeout(w.current),v.current&&(v.current.pause(),v.current=null),e.song?.preview_url){let t=new Audio(e.song.preview_url);v.current=t,t.currentTime=e.song.snippetStart||0,t.play().catch(e=>console.error("Audio play failed",e)),t.addEventListener("ended",S)}return t?b(0):(w.current=setTimeout(S,15e3),requestAnimationFrame(()=>{b(100)})),()=>{w.current&&clearTimeout(w.current),v.current&&(v.current.pause(),v.current.removeEventListener("ended",S))}},[r,n,T,S,x]),(0,l.useEffect)(()=>{let e=e=>{x||("ArrowRight"===e.key&&S(),"ArrowLeft"===e.key&&A())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[S,A,x]),x)return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:(0,t.jsx)("div",{className:"relative w-full max-w-lg h-[90vh] flex flex-col items-center justify-center",children:(0,t.jsx)(f,{onSkip:()=>{p(!1),n<T[r].flashes.length-1?a(e=>e+1):r<T.length-1?(i(e=>e+1),a(0)):U()}})})});let C=T[r];if(!C)return null;let z=C.flashes[n];if(!z)return null;let E=z.mediaUrl&&(z.mediaUrl.includes(".mp4")||z.mediaUrl.includes(".webm")||z.mediaUrl.includes(".ogg")),R=E&&j.current?.duration||15;return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onTouchStart:e=>{x||(y.current=e.touches[0].clientX)},onTouchEnd:e=>{if(x)return;let t=e.changedTouches[0].clientX-y.current;Math.abs(t)>50&&(t<0?S():A())},children:(0,t.jsxs)("div",{className:"relative w-full max-w-lg h-[90vh] flex flex-col items-center justify-center cursor-pointer",onClick:e=>{if(x)return;let{clientX:t,currentTarget:l}=e,{left:s,width:r}=l.getBoundingClientRect();t-s<r/3?A():S()},children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),U()},className:"absolute top-2 right-2 text-white text-3xl z-20",children:"Ã—"}),(0,t.jsx)("div",{className:"absolute top-4 left-2 right-2 flex gap-1 z-20",children:C.flashes.map((e,l)=>(0,t.jsx)("div",{className:"flex-1 h-1 bg-white/30 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-white rounded-full",style:{width:`${l<n?100:l===n?g:0}%`,transition:l!==n||E?"none":`width ${R}s linear`}})},l))}),(0,t.jsx)("div",{className:"w-full h-full relative",children:E?(0,t.jsxs)("div",{className:"relative w-full h-full",children:[(0,t.jsx)("video",{ref:j,src:z.mediaUrl,className:"w-full h-full object-contain",autoPlay:!0,onTimeUpdate:()=>{j.current&&j.current.duration&&b(j.current.currentTime/j.current.duration*100)},onEnded:()=>{S()}}),(0,t.jsx)(d,{isAnimated:!0})]}):(0,t.jsxs)("div",{className:"relative w-full h-full",children:[z.mediaUrl&&(0,t.jsx)("img",{src:z.mediaUrl,alt:"flash",className:"w-full h-full object-contain"}),(0,t.jsx)(d,{})]})}),z.caption&&(0,t.jsx)("div",{className:"absolute bottom-20 left-4 right-4 text-white text-center font-semibold p-2 bg-black/50 rounded-lg",children:z.caption}),(0,t.jsx)(m,{flash:z,currentUser:k,onClose:U})]})})}e.s(["default",()=>h])},74089,e=>{e.n(e.i(23497))}]);