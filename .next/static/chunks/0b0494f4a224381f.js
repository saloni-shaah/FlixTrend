(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88621,e=>{"use strict";let t,a,r,s;var n=e.i(43476),i=e.i(71645),l=e.i(18566);e.i(36180);var o=e.i(98925),c=e.i(61059),d=e.i(43432),u=e.i(78716),m=e.i(75254);let f=(0,m.default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);var p=e.i(87951),g=e.i(14764),x=e.i(71689),h=e.i(73708),y=e.i(37727),b=e.i(97960),v=e.i(27612),j=e.i(61911);let w=(0,m.default)("circle-user",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);var N=e.i(68553),D=e.i(34289),R=e.i(70756),C=e.i(95762),k=e.i(46932),S=e.i(88653),E=e.i(47414),A=e.i(74008),I=e.i(65566),T=e.i(97989),P=e.i(45161);function O(e,t){[...t].reverse().forEach(a=>{let r=e.getVariant(a);r&&(0,T.setTarget)(e,r),e.variantChildren&&e.variantChildren.forEach(e=>{O(e,t)})})}function F(){let e=!1,t=new Set,a={subscribe:e=>(t.add(e),()=>void t.delete(e)),start(a,r){(0,I.invariant)(e,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");let s=[];return t.forEach(e=>{s.push((0,P.animateVisualElement)(e,a,{transitionOverride:r}))}),Promise.all(s)},set:a=>((0,I.invariant)(e,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),t.forEach(e=>{var t,r;t=e,Array.isArray(r=a)?O(t,r):"string"==typeof r?O(t,[r]):(0,T.setTarget)(t,r)})),stop(){t.forEach(e=>{e.values.forEach(e=>e.stop())})},mount:()=>(e=!0,()=>{e=!1,a.stop()})};return a}let M=function(){let e=(0,E.useConstant)(F);return(0,A.useIsomorphicLayoutEffect)(e.mount,[]),e};var _=e.i(30030),z=e.i(20783),U=e.i(81140),$=e.i(10772),B=e.i(69340),L=e.i(26330),V=e.i(65491),H=e.i(74606),W=e.i(96626),G=e.i(48425),K=e.i(3536),Y=e.i(85369),q=e.i(86312),X=Symbol("radix.slottable");function Z(e){return i.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===X}var J="Dialog",[Q,ee]=(0,_.createContextScope)(J),[et,ea]=Q(J),er=e=>{let{__scopeDialog:t,children:a,open:r,defaultOpen:s,onOpenChange:l,modal:o=!0}=e,c=i.useRef(null),d=i.useRef(null),[u,m]=(0,B.useControllableState)({prop:r,defaultProp:s??!1,onChange:l,caller:J});return(0,n.jsx)(et,{scope:t,triggerRef:c,contentRef:d,contentId:(0,$.useId)(),titleId:(0,$.useId)(),descriptionId:(0,$.useId)(),open:u,onOpenChange:m,onOpenToggle:i.useCallback(()=>m(e=>!e),[m]),modal:o,children:a})};er.displayName=J;var es="DialogTrigger",en=i.forwardRef((e,t)=>{let{__scopeDialog:a,...r}=e,s=ea(es,a),i=(0,z.useComposedRefs)(t,s.triggerRef);return(0,n.jsx)(G.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":eR(s.open),...r,ref:i,onClick:(0,U.composeEventHandlers)(e.onClick,s.onOpenToggle)})});en.displayName=es;var ei="DialogPortal",[el,eo]=Q(ei,{forceMount:void 0}),ec=e=>{let{__scopeDialog:t,forceMount:a,children:r,container:s}=e,l=ea(ei,t);return(0,n.jsx)(el,{scope:t,forceMount:a,children:i.Children.map(r,e=>(0,n.jsx)(W.Presence,{present:a||l.open,children:(0,n.jsx)(H.Portal,{asChild:!0,container:s,children:e})}))})};ec.displayName=ei;var ed="DialogOverlay",eu=i.forwardRef((e,t)=>{let a=eo(ed,e.__scopeDialog),{forceMount:r=a.forceMount,...s}=e,i=ea(ed,e.__scopeDialog);return i.modal?(0,n.jsx)(W.Presence,{present:r||i.open,children:(0,n.jsx)(ef,{...s,ref:t})}):null});eu.displayName=ed;var em=((s=i.forwardRef((e,t)=>{let{children:a,...r}=e;if(i.isValidElement(a)){var s;let e,n,l=(s=a,(n=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.ref:(n=(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.props.ref:s.props.ref||s.ref),o=function(e,t){let a={...t};for(let r in t){let s=e[r],n=t[r];/^on[A-Z]/.test(r)?s&&n?a[r]=(...e)=>{let t=n(...e);return s(...e),t}:s&&(a[r]=s):"style"===r?a[r]={...s,...n}:"className"===r&&(a[r]=[s,n].filter(Boolean).join(" "))}return{...e,...a}}(r,a.props);return a.type!==i.Fragment&&(o.ref=t?(0,z.composeRefs)(t,l):l),i.cloneElement(a,o)}return i.Children.count(a)>1?i.Children.only(null):null})).displayName="DialogOverlay.RemoveScroll.SlotClone",t=s,(a=i.forwardRef((e,a)=>{let{children:r,...s}=e,l=i.Children.toArray(r),o=l.find(Z);if(o){let e=o.props.children,r=l.map(t=>t!==o?t:i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null);return(0,n.jsx)(t,{...s,ref:a,children:i.isValidElement(e)?i.cloneElement(e,void 0,r):null})}return(0,n.jsx)(t,{...s,ref:a,children:r})})).displayName="DialogOverlay.RemoveScroll.Slot",a),ef=i.forwardRef((e,t)=>{let{__scopeDialog:a,...r}=e,s=ea(ed,a);return(0,n.jsx)(Y.RemoveScroll,{as:em,allowPinchZoom:!0,shards:[s.contentRef],children:(0,n.jsx)(G.Primitive.div,{"data-state":eR(s.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),ep="DialogContent",eg=i.forwardRef((e,t)=>{let a=eo(ep,e.__scopeDialog),{forceMount:r=a.forceMount,...s}=e,i=ea(ep,e.__scopeDialog);return(0,n.jsx)(W.Presence,{present:r||i.open,children:i.modal?(0,n.jsx)(ex,{...s,ref:t}):(0,n.jsx)(eh,{...s,ref:t})})});eg.displayName=ep;var ex=i.forwardRef((e,t)=>{let a=ea(ep,e.__scopeDialog),r=i.useRef(null),s=(0,z.useComposedRefs)(t,a.contentRef,r);return i.useEffect(()=>{let e=r.current;if(e)return(0,q.hideOthers)(e)},[]),(0,n.jsx)(ey,{...e,ref:s,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,U.composeEventHandlers)(e.onCloseAutoFocus,e=>{e.preventDefault(),a.triggerRef.current?.focus()}),onPointerDownOutside:(0,U.composeEventHandlers)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,a=0===t.button&&!0===t.ctrlKey;(2===t.button||a)&&e.preventDefault()}),onFocusOutside:(0,U.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault())})}),eh=i.forwardRef((e,t)=>{let a=ea(ep,e.__scopeDialog),r=i.useRef(!1),s=i.useRef(!1);return(0,n.jsx)(ey,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(r.current||a.triggerRef.current?.focus(),t.preventDefault()),r.current=!1,s.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(r.current=!0,"pointerdown"===t.detail.originalEvent.type&&(s.current=!0));let n=t.target;a.triggerRef.current?.contains(n)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&s.current&&t.preventDefault()}})}),ey=i.forwardRef((e,t)=>{let{__scopeDialog:a,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:l,...o}=e,c=ea(ep,a),d=i.useRef(null),u=(0,z.useComposedRefs)(t,d);return(0,K.useFocusGuards)(),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(V.FocusScope,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:l,children:(0,n.jsx)(L.DismissableLayer,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":eR(c.open),...o,ref:u,onDismiss:()=>c.onOpenChange(!1)})}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eE,{titleId:c.titleId}),(0,n.jsx)(eA,{contentRef:d,descriptionId:c.descriptionId})]})]})}),eb="DialogTitle",ev=i.forwardRef((e,t)=>{let{__scopeDialog:a,...r}=e,s=ea(eb,a);return(0,n.jsx)(G.Primitive.h2,{id:s.titleId,...r,ref:t})});ev.displayName=eb;var ej="DialogDescription",ew=i.forwardRef((e,t)=>{let{__scopeDialog:a,...r}=e,s=ea(ej,a);return(0,n.jsx)(G.Primitive.p,{id:s.descriptionId,...r,ref:t})});ew.displayName=ej;var eN="DialogClose",eD=i.forwardRef((e,t)=>{let{__scopeDialog:a,...r}=e,s=ea(eN,a);return(0,n.jsx)(G.Primitive.button,{type:"button",...r,ref:t,onClick:(0,U.composeEventHandlers)(e.onClick,()=>s.onOpenChange(!1))})});function eR(e){return e?"open":"closed"}eD.displayName=eN;var eC="DialogTitleWarning",[ek,eS]=(0,_.createContext)(eC,{contentName:ep,titleName:eb,docsSlug:"dialog"}),eE=({titleId:e})=>{let t=eS(eC),a=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return i.useEffect(()=>{e&&(document.getElementById(e)||console.error(a))},[a,e]),null},eA=({contentRef:e,descriptionId:t})=>{let a=eS("DialogDescriptionWarning"),r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${a.contentName}}.`;return i.useEffect(()=>{let a=e.current?.getAttribute("aria-describedby");t&&a&&(document.getElementById(t)||console.warn(r))},[r,e,t]),null},eI=Symbol("radix.slottable"),eT="AlertDialog",[eP,eO]=(0,_.createContextScope)(eT,[ee]),eF=ee(),eM=e=>{let{__scopeAlertDialog:t,...a}=e,r=eF(t);return(0,n.jsx)(er,{...r,...a,modal:!0})};eM.displayName=eT,i.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,s=eF(a);return(0,n.jsx)(en,{...s,...r,ref:t})}).displayName="AlertDialogTrigger";var e_=e=>{let{__scopeAlertDialog:t,...a}=e,r=eF(t);return(0,n.jsx)(ec,{...r,...a})};e_.displayName="AlertDialogPortal";var ez=i.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,s=eF(a);return(0,n.jsx)(eu,{...s,...r,ref:t})});ez.displayName="AlertDialogOverlay";var eU="AlertDialogContent",[e$,eB]=eP(eU),eL=((r=({children:e})=>(0,n.jsx)(n.Fragment,{children:e})).displayName="AlertDialogContent.Slottable",r.__radixId=eI,r),eV=i.forwardRef((e,t)=>{let{__scopeAlertDialog:a,children:r,...s}=e,l=eF(a),o=i.useRef(null),c=(0,z.useComposedRefs)(t,o),d=i.useRef(null);return(0,n.jsx)(ek,{contentName:eU,titleName:eH,docsSlug:"alert-dialog",children:(0,n.jsx)(e$,{scope:a,cancelRef:d,children:(0,n.jsxs)(eg,{role:"alertdialog",...l,...s,ref:c,onOpenAutoFocus:(0,U.composeEventHandlers)(s.onOpenAutoFocus,e=>{e.preventDefault(),d.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,n.jsx)(eL,{children:r}),(0,n.jsx)(eZ,{contentRef:o})]})})})});eV.displayName=eU;var eH="AlertDialogTitle",eW=i.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,s=eF(a);return(0,n.jsx)(ev,{...s,...r,ref:t})});eW.displayName=eH;var eG="AlertDialogDescription",eK=i.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,s=eF(a);return(0,n.jsx)(ew,{...s,...r,ref:t})});eK.displayName=eG;var eY=i.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,s=eF(a);return(0,n.jsx)(eD,{...s,...r,ref:t})});eY.displayName="AlertDialogAction";var eq="AlertDialogCancel",eX=i.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,{cancelRef:s}=eB(eq,a),i=eF(a),l=(0,z.useComposedRefs)(t,s);return(0,n.jsx)(eD,{...i,...r,ref:l})});eX.displayName=eq;var eZ=({contentRef:e})=>{let t=`\`${eU}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${eU}\` by passing a \`${eG}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${eU}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return i.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},eJ=e.i(75157),eQ=e.i(19455);let e0=i.forwardRef(({className:e,...t},a)=>(0,n.jsx)(ez,{className:(0,eJ.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));e0.displayName=ez.displayName;let e1=i.forwardRef(({className:e,...t},a)=>(0,n.jsxs)(e_,{children:[(0,n.jsx)(e0,{}),(0,n.jsx)(eV,{ref:a,className:(0,eJ.cn)("glass-card fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));e1.displayName=eV.displayName;let e2=({className:e,...t})=>(0,n.jsx)("div",{className:(0,eJ.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...t});e2.displayName="AlertDialogHeader";let e6=({className:e,...t})=>(0,n.jsx)("div",{className:(0,eJ.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});e6.displayName="AlertDialogFooter";let e5=i.forwardRef(({className:e,...t},a)=>(0,n.jsx)(eW,{ref:a,className:(0,eJ.cn)("text-lg font-semibold",e),...t}));e5.displayName=eW.displayName;let e4=i.forwardRef(({className:e,...t},a)=>(0,n.jsx)(eK,{ref:a,className:(0,eJ.cn)("text-sm text-muted-foreground",e),...t}));e4.displayName=eK.displayName;let e8=i.forwardRef(({className:e,...t},a)=>(0,n.jsx)(eY,{ref:a,className:(0,eJ.cn)((0,eQ.buttonVariants)(),e),...t}));e8.displayName=eY.displayName;let e3=i.forwardRef(({className:e,...t},a)=>(0,n.jsx)(eX,{ref:a,className:(0,eJ.cn)((0,eQ.buttonVariants)({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));e3.displayName=eX.displayName,e.i(61086);var e7=e.i(27215),e9=e.i(86536);let te=(0,o.getFirestore)(c.app),tt=["Ram","Shyam","Sita","Mohan","Krishna","Radha","Anchal","Anaya","Advik","Diya","Rohan","Priya","Arjun","Saanvi","Kabir"],ta=i.default.memo(({msg:e,isUser:t,selectedChat:a,firebaseUser:r,isSelected:s,onLongPress:l,onClick:c,onShowEmojiPicker:d,showEmojiPicker:u,onShowDeleteConfirm:m,selectionMode:f})=>{var p,g;let x,h,y,j=((e,t=300)=>{let a=i.default.useRef(),r=()=>{a.current=setTimeout(e,t)},s=()=>{a.current&&clearTimeout(a.current)};return{onTouchStart:r,onTouchEnd:s,onMouseDown:r,onMouseUp:s,onMouseLeave:s}})(()=>{f?c():l()}),w=a.isGroup?"simple"===a.groupType?a.memberInfo?.[e.sender]:null:a,N="anonymous"===a.groupType?(p=e.sender,g=a.id,h=Math.abs((x=e=>{let t=0;for(let a=0;a<e.length;a++)t=Math.imul(31,t)+e.charCodeAt(a)|0;return t})(p+g))%tt.length,y=Math.abs(x(g+p))%900+100,`${tt[h]}${y}`):"pseudonymous"===a.groupType?a.pseudonyms?.[e.sender]||"Anon":w?.name||"User",D=async t=>{if(!r)return;let s=(0,o.doc)(te,"chats",a.id,"messages",e.id),n={...e.reactions||{}},i=!1,l="";for(let[e,t]of Object.entries(n))if(Array.isArray(t)&&t.includes(r.uid)){i=!0,l=e;break}i&&l===t?(n[l]=n[l].filter(e=>e!==r.uid),0===n[l].length&&delete n[l]):(i&&(n[l]=n[l].filter(e=>e!==r.uid),0===n[l].length&&delete n[l]),n[t]||(n[t]=[]),n[t].push(r.uid)),await (0,o.updateDoc)(s,{reactions:n}),d(null)},R=(()=>{if(!t||"system"===e.sender)return"none";let s=a.isGroup?a.members.filter(e=>e!==r.uid):[a.id],n=e.readBy||[];return s.every(e=>n.includes(e))?"all_seen":n.length>1?"delivered":"sent"})();return(0,n.jsx)("div",{onClick:c,...j,className:(0,eJ.cn)("group flex w-full items-end gap-2",t?"justify-end":"system"===e.sender?"justify-center":"justify-start","messages"===f&&"cursor-pointer"),children:(0,n.jsx)("div",{className:(0,eJ.cn)("flex items-end gap-2 max-w-[80%] md:max-w-[70%]",s&&"bg-accent-cyan/20 rounded-xl"),children:(0,n.jsxs)("div",{className:`flex flex-col ${t?"items-end":"items-start"}`,children:[(0,n.jsxs)("div",{className:`relative px-4 py-2 rounded-2xl transition-all duration-300 ${t?"bg-accent-cyan text-white rounded-br-none":"system"===e.sender?"bg-gray-800 text-gray-400 text-xs italic":"bg-gray-700 text-white rounded-bl-none"}`,children:[!t&&"system"!==e.sender&&(0,n.jsx)("div",{className:"font-bold text-sm text-accent-pink",children:N}),"image"===e.type&&(0,n.jsx)("img",{src:e.mediaUrl,alt:e.text||"image",className:"rounded-lg max-w-xs mt-1"}),"video"===e.type&&(0,n.jsx)("video",{src:e.mediaUrl,controls:!0,className:"rounded-lg max-w-xs"}),"audio"===e.type&&(0,n.jsx)("audio",{src:e.mediaUrl,controls:!0}),e.text&&(0,n.jsx)("p",{className:"mt-1 break-words",children:e.text}),(0,n.jsxs)("div",{className:`text-xs mt-1 flex items-center gap-1 ${t?"justify-end":"justify-start"}`,children:[(0,n.jsx)("span",{children:e.createdAt?.toDate?.().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})||""}),"none"!==R&&(0,n.jsxs)("span",{className:"relative flex items-center",children:[(0,n.jsx)(e9.Eye,{size:14,className:(0,eJ.cn)("transition-colors","all_seen"===R?"text-blue-400":"text-gray-500")}),"all_seen"===R&&(0,n.jsx)(e9.Eye,{size:14,className:"absolute -right-1 text-blue-400"})]})]}),e.reactions&&Object.keys(e.reactions).length>0&&(0,n.jsx)("div",{className:"absolute -bottom-4 -right-1 flex gap-1",children:Object.entries(e.reactions).map(([e,t])=>(0,n.jsxs)("div",{className:"bg-gray-600 px-1.5 py-0.5 rounded-full text-xs flex items-center gap-1",children:[(0,n.jsx)("span",{children:e}),(0,n.jsx)("span",{className:"font-bold text-xs",children:Array.isArray(t)?t.length:0})]},e))})]}),(0,n.jsxs)("div",{className:`relative hidden group-hover:flex items-center gap-1 mt-1 ${t?"flex-row-reverse":""}`,children:["system"!==e.sender&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("button",{onClick:()=>d(u===e.id?null:e.id),className:"p-1 rounded-full bg-gray-600 hover:bg-gray-500",children:(0,n.jsx)(b.Smile,{size:16})}),(0,n.jsx)(S.AnimatePresence,{children:u===e.id&&(0,n.jsx)(k.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute z-10 -top-10 bg-gray-800 rounded-full p-2 flex gap-1 shadow-lg",children:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜¢","ðŸ˜®","ðŸ™"].map(e=>(0,n.jsx)("button",{onClick:()=>D(e),className:"text-xl hover:scale-125 transition-transform",children:e},e))})})]})}),t&&(0,n.jsx)("button",{onClick:m,className:"p-1 rounded-full bg-gray-600 hover:bg-red-500",children:(0,n.jsx)(v.Trash2,{size:16})})]})]})})},e.id)});ta.displayName="MessageItem";let tr=i.forwardRef(({className:e,...t},a)=>(0,n.jsx)("textarea",{className:(0,eJ.cn)("flex min-h-[40px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","bg-transparent border-2 border-glass-border focus:ring-accent-green focus:border-accent-green",e),ref:a,...t}));tr.displayName="Textarea";let ts=(0,o.getFirestore)(c.app),tn=(0,e7.getStorage)(c.app);function ti({firebaseUser:e,userProfile:t,chatId:a}){let r,s,m=(0,l.useRouter)(),{drafts:E,setDraft:A}=(0,C.useAppState)(),[I,T]=(0,i.useState)(null),[P,O]=(0,i.useState)([]),[F,_]=(0,i.useState)(""),z=(0,i.useRef)(null),U=(0,i.useRef)(null),$=(0,i.useRef)(null),[B,L]=(0,i.useState)(!1),[V,H]=(0,i.useState)(!1),[W,G]=(0,i.useState)(0),K=(0,i.useRef)(null),Y=(0,i.useRef)([]),q=(0,i.useRef)(null),X=(0,i.useRef)(null),Z=M(),[J,Q]=(0,i.useState)(null),[ee,et]=(0,i.useState)(new Set),[ea,er]=(0,i.useState)(!1),[es,en]=(0,i.useState)(null),ei=(0,i.useRef)(null),[el,eo]=(0,i.useState)(!1),[ec,ed]=(0,i.useState)(!1),eu=(0,i.useRef)(null),em=(0,i.useRef)(null),[ef,ep]=(0,i.useState)(!1),[eg,ex]=(0,i.useState)(null),[eh,ey]=(0,i.useState)(null),[eb,ev]=(0,i.useState)(null);(0,i.useEffect)(()=>{_(E[a]||"")},[a,E]),(0,i.useEffect)(()=>{let t;if(!a||!e)return;if(a.includes("_")){let r=a.replace(e.uid,"").replace("_","");t=(0,o.onSnapshot)((0,o.doc)(ts,"users",r),e=>{e.exists()&&T({id:e.id,...e.data(),isGroup:!1})})}else t=(0,o.onSnapshot)((0,o.doc)(ts,"groups",a),e=>{e.exists()&&T({id:e.id,...e.data(),isGroup:!0})});let r=(0,o.query)((0,o.collection)(ts,"chats",a,"messages"),(0,o.orderBy)("createdAt","asc")),s=(0,o.onSnapshot)(r,t=>{let r=t.docs.map(e=>({id:e.id,...e.data()})),s=r.filter(t=>t.sender!==e.uid&&!(t.readBy||[]).includes(e.uid));if(s.length>0){let t=(0,o.writeBatch)(ts);s.forEach(r=>{let s=(0,o.doc)(ts,"chats",a,"messages",r.id);t.update(s,{readBy:(0,o.arrayUnion)(e.uid)})}),t.commit().catch(e=>console.error("Error marking messages as read:",e))}O(r)});return()=>{t(),s()}},[a,e]),(0,i.useEffect)(()=>{z.current?.scrollIntoView({behavior:"smooth"})},[P]);let ej=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});ev(e),eu.current&&(eu.current.srcObject=e)}catch(e){console.error("Camera error:",e),alert("Camera access denied. Please enable it in your browser settings."),ed(!1)}},ew=()=>{eb&&(eb.getTracks().forEach(e=>e.stop()),ev(null))};(0,i.useEffect)(()=>(ec?ej():ew(),ew),[ec]);let eN=async(t,r=null,s="text")=>{if(t?.preventDefault(),!F.trim()&&!r||!e||!I)return;let n=F.trim();_(""),A(a,""),$.current&&($.current.style.height="auto"),ei.current&&clearTimeout(ei.current);let i={sender:e.uid,createdAt:(0,o.serverTimestamp)(),type:s,readBy:[e.uid],reactions:{},deletedFor:[]};r?(i.mediaUrl=r,n&&(i.text=n)):i.text=n,await (0,o.addDoc)((0,o.collection)(ts,"chats",a,"messages"),i)},eD=async t=>{if(0===ee.size)return;let r=(0,o.writeBatch)(ts);ee.forEach(s=>{let n=(0,o.doc)(ts,"chats",a,"messages",s);"me"===t?r.update(n,{deletedFor:(0,o.arrayUnion)(e.uid)}):r.delete(n)});try{await r.commit()}catch(e){console.error("Error deleting messages:",e),alert("Could not delete messages.")}finally{eR()}},eR=()=>{Q(null),et(new Set)},eC=async(e,t)=>{let a=c.auth.currentUser;if(!a)return void ex("You must be logged in to upload files.");if(!e.type.startsWith("image/"))return void ex("Only images can be sent in chat.");if(e.size>5242880)return void ex("Image size cannot exceed 5MB.");ep(!0),ex("");let r=null;t||ey(r=URL.createObjectURL(e));try{let r="audio"===t?`voice_messages/${a.uid}`:`chat_media/${a.uid}`,s=`${Date.now()}-${e.name}`,n=(0,e7.ref)(tn,`${r}/${s}`),i=await (0,e7.uploadBytes)(n,e),l=await (0,e7.getDownloadURL)(i.ref),o=t||(e.type.startsWith("video/")?"video":"image");await eN(void 0,l,o)}catch(e){console.error("Upload failed:",e),ex(e.message)}finally{ep(!1),r&&(URL.revokeObjectURL(r),ey(null))}},ek=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});K.current=new MediaRecorder(e),Y.current=[],K.current.ondataavailable=e=>{Y.current.push(e.data)},K.current.onstop=async()=>{let t=new Blob(Y.current,{type:"audio/webm"});if(t.size>5242880){ex("Voice message is too large (max 5MB)."),e.getTracks().forEach(e=>e.stop());return}let a=new File([t],`voice-message-${Date.now()}.webm`,{type:"audio/webm"});await eC(a,"audio"),e.getTracks().forEach(e=>e.stop())},K.current.start(),L(!0),G(0),q.current=setInterval(()=>{G(e=>e+1)},1e3)}catch(e){console.error("Audio recording failed:",e),ex("Microphone access denied.")}};return ec?(0,n.jsxs)("div",{className:"absolute inset-0 z-20 bg-black flex flex-col items-center justify-center",children:[(0,n.jsx)("video",{ref:eu,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,n.jsx)("canvas",{ref:em,className:"hidden"}),(0,n.jsxs)("div",{className:"absolute bottom-4 flex items-center gap-4",children:[(0,n.jsx)("button",{onClick:()=>ed(!1),className:"p-3 bg-gray-800/70 rounded-full text-white",children:(0,n.jsx)(y.X,{})}),(0,n.jsx)("button",{onClick:()=>{if(eu.current&&em.current){let e=eu.current,t=em.current;t.width=e.videoWidth,t.height=e.videoHeight;let a=t.getContext("2d");a?.drawImage(e,0,0,e.videoWidth,e.videoHeight),t.toBlob(async e=>{if(e){let t=new File([e],`capture-${Date.now()}.jpg`,{type:"image/jpeg"});ed(!1),await eC(t)}},"image/jpeg")}},className:"w-20 h-20 rounded-full bg-white border-4 border-gray-400"})]})]}):I?(0,n.jsxs)("div",{className:"flex-1 flex flex-col bg-black/40 h-full",children:[(0,n.jsxs)("header",{className:"flex items-center gap-3 p-3 border-b border-accent-cyan/10 bg-black/60 shadow-md shrink-0",children:[(0,n.jsx)("button",{onClick:()=>m.push("/signal"),className:"p-2 rounded-full hover:bg-accent-cyan/10",children:(0,n.jsx)(x.ArrowLeft,{size:20})}),(0,n.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-tr from-accent-pink to-accent-cyan flex items-center justify-center text-white font-bold text-lg overflow-hidden shrink-0",children:I.isGroup?I.avatar_url?(0,n.jsx)("img",{src:I.avatar_url,alt:I.name,className:"w-full h-full object-cover"}):(0,n.jsx)(j.Users,{}):I.avatar_url?(0,n.jsx)("img",{src:I.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):(0,n.jsx)(w,{})}),(0,n.jsx)("div",{className:"flex-1 text-left",children:(0,n.jsx)("h3",{className:"font-bold text-white",children:I.name||I.username})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[!I.isGroup&&(0,n.jsx)("button",{className:"p-2 rounded-full hover:bg-accent-cyan/10",children:(0,n.jsx)(u.Video,{size:20})}),!I.isGroup&&(0,n.jsx)("button",{className:"p-2 rounded-full hover:bg-accent-cyan/10",children:(0,n.jsx)(d.Phone,{size:20})})]})]}),(0,n.jsx)(S.AnimatePresence,{children:"messages"===J&&(0,n.jsxs)(k.motion.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"p-3 border-b border-accent-cyan/10 flex items-center justify-between shrink-0 bg-accent-cyan/10 fixed top-[65px] left-0 right-0 z-10 md:left-1/3",children:[(0,n.jsx)("button",{onClick:eR,children:(0,n.jsx)(y.X,{size:24})}),(0,n.jsxs)("span",{className:"font-bold",children:[ee.size," selected"]}),(0,n.jsx)("button",{onClick:()=>er(!0),children:(0,n.jsx)(v.Trash2,{size:24})})]})}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-1",children:[(r=null,s=[],P.filter(t=>!(t.deletedFor||[]).includes(e.uid)).forEach(t=>{let a=t.createdAt?.toDate();if(a){let e=a.toDateString();if(e!==r){let t,i,l,o;s.push((0,n.jsx)("div",{className:"text-center my-4",children:(0,n.jsx)("span",{className:"bg-gray-800 text-gray-400 text-xs font-bold px-3 py-1 rounded-full",children:((l=new Date(i=new Date((t=new Date).getFullYear(),t.getMonth(),t.getDate()))).setDate(l.getDate()-1),(o=new Date(a.getFullYear(),a.getMonth(),a.getDate())).getTime()===i.getTime()?"Today":o.getTime()===l.getTime()?"Yesterday":a.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))})},e)),r=e}}let i=t.sender===e.uid;s.push((0,n.jsx)(ta,{msg:t,isUser:i,selectedChat:I,firebaseUser:e,isSelected:ee.has(t.id),selectionMode:J,onLongPress:()=>{Q("messages"),et(new Set([t.id]))},onClick:()=>{if("messages"===J){let e=new Set(ee);e.has(t.id)?e.delete(t.id):e.add(t.id),et(e),0===e.size&&eR()}},onShowEmojiPicker:en,showEmojiPicker:es,onShowDeleteConfirm:()=>{et(new Set([t.id])),er(!0)}},t.id))}),s),(0,n.jsx)("div",{ref:z})]}),(0,n.jsxs)("footer",{className:"shrink-0 p-2 border-t border-accent-cyan/10 bg-black/60 relative",children:[(0,n.jsx)(S.AnimatePresence,{children:el&&(0,n.jsxs)(k.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute bottom-full left-2 w-48 bg-gray-800 rounded-lg shadow-lg p-2 flex flex-col gap-1",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>{eo(!1),ed(!0)},className:"btn-glass text-sm justify-start gap-2 text-white",children:[(0,n.jsx)(N.Camera,{})," Take Photo"]}),(0,n.jsxs)("button",{type:"button",onClick:()=>U.current?.click(),className:"btn-glass text-sm justify-start gap-2 text-white",children:[(0,n.jsx)(h.Image,{})," Upload Image"]})]})}),(0,n.jsxs)("form",{onSubmit:e=>eN(e),className:"flex items-end gap-2",children:[!V&&(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("button",{type:"button",onClick:()=>eo(e=>!e),className:"p-2 text-gray-400 hover:text-accent-cyan shrink-0",children:(0,n.jsx)(f,{size:20})}),(0,n.jsx)("button",{type:"button",className:"p-2 text-gray-400 hover:text-accent-cyan shrink-0",onClick:()=>{$.current?.focus();try{$.current&&"showPicker"in HTMLInputElement.prototype&&$.current.showPicker()}catch(e){console.warn("Could not programmatically open emoji keyboard.")}},children:(0,n.jsx)(b.Smile,{size:20})})]}),V?(0,n.jsxs)("div",{className:"flex-1 flex items-center gap-3 bg-gray-700 rounded-full px-4 py-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{K.current&&B&&(K.current.onstop=()=>{K.current?.stream.getTracks().forEach(e=>e.stop())},K.current.stop()),q.current&&clearInterval(q.current),L(!1),H(!1)},className:"text-red-400",children:"Cancel"}),(0,n.jsxs)("div",{className:"flex-1 text-center text-red-400 animate-pulse font-mono",children:[Math.floor(W/60).toString().padStart(2,"0"),":",(W%60).toString().padStart(2,"0")]})]}):(0,n.jsx)("div",{className:"flex-1 relative flex items-center",children:(0,n.jsx)(tr,{ref:$,value:F,onChange:t=>{let r=t.target.value;if(_(r),$.current&&($.current.style.height="auto",$.current.style.height=`${$.current.scrollHeight}px`),I){A(a,r),ei.current&&clearTimeout(ei.current);let t=(0,o.doc)(ts,I.isGroup?"groups":"users",I.id);(0,o.updateDoc)(t,{typing:(0,o.arrayUnion)(e.uid)}).catch(()=>{}),ei.current=setTimeout(()=>{(0,o.updateDoc)(t,{typing:(0,o.arrayRemove)(e.uid)}).catch(()=>{})},3e3)}},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||eN(e)},placeholder:B?"Recording...":"Type a message...",className:"flex-1 bg-gray-700 rounded-xl px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-accent-cyan w-full pr-10 resize-none max-h-32",rows:1})}),(0,n.jsx)("input",{type:"file",ref:U,onChange:e=>{eo(!1);let t=e.target.files?.[0];t&&eC(t),e.target&&(e.target.value="")},className:"hidden",accept:"image/*"}),(0,n.jsx)(S.AnimatePresence,{mode:"wait",children:""!==F.trim()||V?(0,n.jsx)(k.motion.button,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},type:"submit",className:"p-3 rounded-full bg-accent-cyan text-black shrink-0",children:(0,n.jsx)(g.Send,{size:20})},"send"):(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(k.motion.div,{id:"lock-icon",className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 p-2 bg-gray-800 rounded-full pointer-events-none",animate:Z,initial:{y:-100,opacity:0},children:(0,n.jsx)(R.Lock,{size:20})}),(0,n.jsx)(k.motion.button,{ref:X,onTouchStart:e=>{e.preventDefault(),Z.start({y:0,opacity:1}),ek()},onTouchEnd:()=>{Z.start({y:-100,opacity:0}),V||(K.current&&B&&K.current.stop(),q.current&&clearInterval(q.current),L(!1),H(!1))},onTouchMove:e=>{let t=e.touches[0],a=document.getElementById("lock-icon");if(a){let{top:e,right:r,bottom:s,left:n}=a.getBoundingClientRect();t.clientX>n&&t.clientX<r&&t.clientY>e&&t.clientY<s&&(H(!0),K.current&&B&&Z.start({y:-100,opacity:0}))}},animate:{scale:B?1.2:1},type:"button",className:`p-3 rounded-full transition-colors shrink-0 ${B?"bg-red-500 animate-pulse":"bg-accent-pink text-white"}`,children:(0,n.jsx)(p.Mic,{size:20})},"mic")]})})]})]}),(0,n.jsx)(eM,{open:ea,onOpenChange:er,children:(0,n.jsxs)(e1,{children:[(0,n.jsxs)(e2,{children:[(0,n.jsx)(e5,{children:"Delete Message(s)?"}),(0,n.jsx)(e4,{children:"This action cannot be undone."})]}),(0,n.jsxs)(e6,{children:[(0,n.jsx)(e3,{children:"Cancel"}),(0,n.jsx)(e8,{onClick:()=>eD("me"),className:"bg-yellow-600 hover:bg-yellow-700",children:"Delete for Me"}),(0,n.jsx)(e8,{onClick:()=>eD("everyone"),className:"bg-red-600 hover:bg-red-700",children:"Delete for Everyone"})]})]})})]}):(0,n.jsxs)("div",{className:"flex h-full w-full items-center justify-center text-accent-cyan",children:[(0,n.jsx)(D.Loader,{className:"animate-spin"})," Loading Chat..."]})}function tl(){let e=(0,l.useParams)().id,[t,a]=(0,i.useState)(null),[r,s]=(0,i.useState)(null),[d,u]=(0,i.useState)(!0),m=(0,l.useRouter)();return((0,i.useEffect)(()=>{let e=c.auth.onAuthStateChanged(async e=>{if(e){a(e);let t=(0,o.doc)(ts,"users",e.uid),r=(0,o.onSnapshot)(t,t=>{t.exists()?s({...e,...t.data()}):s(e),u(!1)});return()=>r()}m.push("/login"),u(!1)});return()=>e()},[m]),!d&&t&&r)?(0,n.jsx)(ti,{firebaseUser:t,userProfile:r,chatId:e}):(0,n.jsxs)("div",{className:"flex h-full items-center justify-center text-accent-cyan",children:[(0,n.jsx)(D.Loader,{className:"animate-spin"})," Loading Chat..."]})}function to(){return(0,n.jsx)("div",{className:"h-full w-full",children:(0,n.jsx)(i.Suspense,{fallback:(0,n.jsxs)("div",{className:"flex h-full items-center justify-center text-accent-cyan",children:[(0,n.jsx)(D.Loader,{className:"animate-spin"})," Loading Chat..."]}),children:(0,n.jsx)(tl,{})})})}e.s(["default",()=>to],88621)}]);